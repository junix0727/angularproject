/*! package 2018-06-29 */

function ShowModalDialog(e,t,n){0===$("#sys-dialog").length&&$("<div id='sys-dialog'></div>").appendTo("body"),$("#sys-dialog").html('<textarea id="sys-dialog-text" rows="10" style="width:312px !important;"></textarea>'),$("#sys-dialog-text").val($("#"+e).val()),$("#sys-dialog").dialog({autoOpen:!0,height:300,width:350,modal:!0,dialogClass:"lya-modal",buttons:{OK:function(){$("#"+e).val($("#sys-dialog-text").val()),$("#"+t).attr("title",$("#sys-dialog-text").val()),""!==$("#sys-dialog-text").val()?$("#"+t).switchClass("icon-empty-note","icon-note"):$("#"+t).switchClass("icon-note","icon-empty-note"),$(this).dialog("close"),"function"==typeof n&&n()},Cancel:function(){$(this).dialog("close")},Timestamp:function(){var e=new Date;$("#sys-dialog-text").append(e.toLocaleString())}},close:function(){$("#sys-dialog-text").val("").removeClass("ui-state-error")}})}function SearchBoxKeyDown(e,t,n,i,o){if(-1<$.inArray(e.keyCode,[38,40,13]))SearchBoxNavigateContextMenu(e,t);else if(27===e.keyCode)var r=$("#"+t).nextAll("div.context-menu").remove();else if(9===e.keyCode&&i){if(1==(r=$("#"+t).nextAll("div.context-menu").first()).children().size())return void r.children().first().trigger("click");var a=r.find(".selected");0!=a.length?a.trigger("click"):SearchBoxFind(e,t,!0,n)}else 113===e.keyCode&&SearchBoxOpenPage(t,n,o)}function SearchBoxNavigateContextMenu(e,t){e.preventDefault();var n=$("#"+t).nextAll("div.context-menu").first();if(38==e.keyCode){var i=(o=n.find(".selected")).prev("div");0==o.length||0==i.length?(n.find("div").last().addClass("selected"),0!=o.length&&o.removeClass("selected")):(i.addClass("selected"),o.removeClass("selected"))}if(40==e.keyCode){var o,r=(o=n.find(".selected")).next("div");0==o.length||0==r.length?(n.find("div").first().addClass("selected"),0!=o.length&&o.removeClass("selected")):(r.addClass("selected"),o.removeClass("selected"))}13==e.keyCode&&n.find(".selected").trigger("click")}function SearchBoxFind(e,i,o,t,n){if(!(-1<$.inArray(e.keyCode,[38,40,13,27]))&&113!==e.keyCode&&(9!==e.keyCode||n)){var r=$("#"+i),a=$("#"+i+"Link"),s=$("#"+i+"Label"),l=$("#"+i+"Value"),c=r.val();a.removeClass("error"),$(".context-menu").remove(),$.ajax({type:"POST",url:"/Views/Shared/SearchForm.aspx/Find",data:"{text: '"+c+"', type: '"+t+"'}",contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){if(o){var t=jQuery.parseJSON(e.d);if(null!==t&&1===t.length){l.val(t[0].Id+","+t[0].Code+","+t[0].Description);var n=t[0].Description;40<n.length&&(n=n.substring(0,40)+"..."),a.html(n),s.html(n),r.val(t[0].Code),l.trigger("change")}else a.html("No data found").addClass("error")}else ShowSearchResults(i,e.d)}})}}function ShowSearchResults(e,t){var n=$("#"+e).position(),i="left:"+n.left+"px; top: "+(n.top+23)+"px;",o=$('<div class="context-menu" style="'+i+'"></div>');if(""!==t)for(var r=jQuery.parseJSON(t),a=0;a<Math.min(10,r.length);a++){var s=r[a].Description;s||(s=""),null!=s&&40<s.length&&(s=s.substring(0,40)+"...");var l=$("<div idvalue='"+r[a].Id+"' code='"+r[a].Code+"'><span class='key'>"+s+"</span><span class='value'>("+r[a].Code+")</span></div>");o.append(l)}else o.append("<div>No data found. F2 = Search</div>");$("#"+e).after(o),""!==t&&$(".context-menu div").click(function(){$("#"+e+"Value").val($(this).attr("idvalue")+","+$(this).attr("code")+","+$(this).children("span.key").html()),$("#"+e+"Link").html($(this).children("span.key").html()),$("#"+e+"Label").html($(this).children("span.key").html()),$("#"+e).val($(this).attr("code")),$("#"+e+"Value").trigger("change"),$(".context-menu").remove()}),$(".context-menu div").mouseleave(function(){$(this).removeClass("selected")}),$("#"+e).blur(function(){$(".context-menu").fadeOut(200,function(){$(".context-menu").remove})}),$(".context-menu").mouseleave(function(){$(".context-menu").remove()}),$(".context-menu").mouseenter(function(){$(".context-menu div").removeClass("selected")})}function SearchBoxOpenPage(e,t,n){$(".context-menu").remove();var i="";return 0!==$("#"+e).length&&"True"==n&&(i=$("#"+e).val()),ShowDialog("/Views/Shared/SearchForm.aspx?id="+e+"&type="+t+"&key="+i,800,600,"no"),!1}function ShowDialog(e,t,n,i){var o=$("body"),r=!1;void 0!==window.parent&&(o=window.parent.$("body")),null!==window.frameElement&&(r=!0);var a=o.find(".ui-dialog").length;o.append('<div id="popup_'+a+'"></div>'),o.find("#popup_"+a).dialog({open:function(){$(this).html('<iframe id="dialogIframe_'+a+'" width="'+t+'" height="'+n+'" src="'+e+"&dialogid="+a+(r?"&parentFrame="+window.frameElement.id:"")+' " scrolling="'+i+'"></iframe>')},beforeClose:function(e){$(this).empty()},close:function(e){$(this).remove()},width:t+25,height:n+45,modal:!0,dialogClass:"lya-modal",resizable:!1})}function OnRequiredValidation(e,t){void 0===t.value||null===t.value?($("#"+e.name).addClass("error-table"),t.isValid=!1):($("#"+e.name).removeClass("error-table"),t.isValid=!0)}var dropZone;!function(e){"use strict";exeApp.controller("SearchBoxController",["$scope","$http",function(o,t){o.init=function(e,t){o.SelectedItem=e,o.Options=t},o.onSelect=function(e,t,n){o.SelectedItem=e;var i=$("#"+o.Options.ClientID+"Value");i.val(o.SelectedItem.Id+","+o.SelectedItem.Code+","+o.SelectedItem.Description),i.trigger("change")},o.getValues=function(e){return t.get("/Handlers/SearchHandler.ashx",{params:{query:e,type:o.Options.Type}}).then(function(e){var t=[];return e.data.forEach(function(e){t.push(e)}),t})}}]),exeApp.filter("default",[function(){return function(e,t){return e||t}}])}(window.angular);var filesDropped,uploadedFiles=0;function initDropzone(o){if((dropZone=$("#dropZone")).removeClass("error"),void 0===window.FileReader)return dropZone.text("Browser Not Supported!"),void dropZone.addClass("error");dropZone[0].ondragover=function(){return dropZone.addClass("hover"),!1},dropZone[0].ondragend=function(){return dropZone.removeClass("hover"),!1},dropZone[0].ondrop=function(e){e.preventDefault();var t=e.dataTransfer.files;filesDropped=t.length,$("#progressZone").empty();for(var n=0;n<t.length;n++){var i=t[n];$("#progressZone").append('<div id="progress'+n+'"></div>'),i.size>maxRequestLength?($("#progress"+n).html('                             <div class="fileName">'+trimString(i.name)+'</div>                             <div class="barError"></div>                             <div class="uploadError">Error: File Too Large!</div>'),uploadedFiles++):(type="application/pdf",i.type==type?(dropZone.text("Upload In Progress..."),uploadFile(i,n)):($("#progress"+n).html('                             <div class="fileName">'+trimString(i.name)+'</div>                             <div class="barError"></div>                             <div class="uploadError">Error: Only PDF files allowed!</div>'),uploadedFiles++))}"function"==typeof o&&setTimeout(o,1e3)}}function uploadFile(t,n){var e=new XMLHttpRequest;e.upload.addEventListener("progress",function(e){$("#progress"+n).html('                 <div class="fileName"> '+trimString(t.name)+'</div>                 <div class="barHolder">                     <div id="barFiller'+n+'" class="barFiller" style="width: '+parseInt(e.loaded/e.total*100)+'%"></div>                 </div>                 <div id="uploadProgress'+n+'" class="uploadProgress">Uploading: '+parseInt(e.loaded/e.total*100)+"%</div>")},!1),e.onreadystatechange=function(e){4==e.target.readyState&&(200==e.target.status||304==e.target.status?$("#uploadProgress"+n).html("Upload Complete."):($("#barFiller"+n).addClass("barError"),$("#uploadProgress"+n).html("Error: XMLHttpRequest Error!"),$("#uploadProgress"+n).addClass("uploadError")),filesDropped<=++uploadedFiles&&(dropZone.removeClass("hover"),dropZone.text("Drop Files Here.")))},e.open("POST","/Views/MasterData/DocumentEdit.aspx",!0),e.setRequestHeader("X-FILE-NAME",t.name),e.send(t)}function trimString(e){return allowedLength=27,e.length>allowedLength?e.substring(0,allowedLength)+"...":e}function GetOurRefDataForCash(e){var t=$("#"+e.name+"Value").val().split(",");if(t[0]){var n=t[0],i=t[1];$(".context-menu").remove(),$.ajax({type:"POST",url:"/Views/Cash/CashEntry.aspx/GetOurRefData",data:"{itemValue: '"+n+"', itemRef: '"+i+"'}",contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){var n=jQuery.parseJSON(e.d);if(null!==n&&1===n.length){var i=-1;$.each(n[0],function(e,t){("uxAccount"!=e&&"uxGLAccount"!=e||($("#"+e+"Value").val(t+","+n[0][e+"Code"]+","+n[0][e+"Desc"]),$("#"+e+"Link").html(n[0][e+"Desc"]),$("#"+e+"Label").html(n[0][e+"Desc"]),$("#"+e).val(n[0][e+"Code"]),$("#"+e+"Value").trigger("change")),"Description"==e)&&uxLineList.GetEditor(e).SetValue(t);"AmountBalance"==e&&uxLineList.GetEditor("Amount").SetValue(t);"JournalType"==e&&(i=t)});var t=uxLineList.GetEditor("Description"),o=uxLineList.GetEditor("Amount");if(0==i){var r="";null!=t.GetValue()&&(r=":"+t.GetValue()),t.SetValue("Sales"+r)}else 1==i&&o.SetValue(-1*o.GetValue())}$("#uxAccount").focus()}})}else $("#"+e.name).focus()}function GetOurRefDataForBank(e){var t=e.split(","),n=$("#"+t[0]+"Value").val().split(",");if($("#"+t[0]+"Value").val().split(",")[0]){var i=n[0],o=n[1],r=(t[1],uxLineList.GetEditor("DocumentDate")),a=(r.GetValue().getMonth()+1).toString()+"/"+r.GetValue().getDate().toString()+"/"+r.GetValue().getFullYear().toString();$(".context-menu").remove(),$.ajax({type:"POST",url:"/Views/Banks/BankEntry.aspx/GetOurRefData",data:"{itemValue: '"+i+"', itemRef: '"+o+"', date: '"+a+"'  }",contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){var n=jQuery.parseJSON(e.d);if(null!==n&&1===n.length){var i=-1,o=1;$.each(n[0],function(e,t){("uxAccount"!=e&&"uxGLAccount"!=e||($("#"+e+"Value").val(t+","+n[0][e+"Code"]+","+n[0][e+"Desc"]),$("#"+e+"Link").html(n[0][e+"Desc"]),$("#"+e+"Label").html(n[0][e+"Desc"]),$("#"+e).val(n[0][e+"Code"]),$("#"+e+"Value").trigger("change")),"Description"==e)&&uxLineList.GetEditor(e).SetValue(t);"AmountBalance"==e&&uxLineList.GetEditor("Amount").SetValue(t);("InvoiceCurrencyId"==e&&t,"JournalType"==e&&(i=t),"ExchangeRate"==e)&&(uxLineList.GetEditor(e).SetValue(t),o=t);"uxAccount"!=e&&"uxGLAccount"!=e||($("#"+e+"Value").val(t+","+n[0][e+"Code"]+","+n[0][e+"Desc"]),$("#"+e+"Link").html(n[0][e+"Desc"]),$("#"+e+"Label").html(n[0][e+"Desc"]),$("#"+e).val(n[0][e+"Code"]),$("#"+e+"Value").trigger("change"))});var t=uxLineList.GetEditor("Amount"),r=uxLineList.GetEditor("Description");0==i?r.SetValue("Sales:"+r.GetValue()):1==i&&t.SetValue(-1*t.GetValue());var a=0,s=uxLineList.GetEditor("ExchangeAmount");if(null!=t){var l=uxLineList.GetEditor("VATAmount"),c=0;null!=l&&(c=l.GetValue()),a=(c+t.GetValue())/o}s.SetValue(a)}}})}else $("#"+t[0]).focus()}function OnChangeAmountBank(){var e=uxLineList.GetEditor("DocumentDate"),t=(e.GetValue().getMonth()+1).toString()+"/"+e.GetValue().getDate().toString()+"/"+e.GetValue().getFullYear().toString();$(".context-menu").remove(),$.ajax({type:"POST",url:"/Views/Banks/BankEntry.aspx/GetExchangeRate",data:"{date: '"+t+"'}",contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){var t=e.d;if(null!==t){var n=uxLineList.GetEditor("Amount"),i=parseFloat(t),o=chIsExchange.GetChecked(),r=0,a=uxLineList.GetEditor("ExchangeAmount"),s=uxLineList.GetEditor("ExchangeRate");if(null!=n){var l=uxLineList.GetEditor("VATAmount"),c=0;null!=l&&(c=l.GetValue()),1==o?(s.SetValue(i),r=(c+n.GetValue())/i):s.SetValue(0)}a.SetValue(r)}}})}function OnChangeVATWF(e){var s=e.split(","),t=$("#"+s[0]+"Value").val().split(",");if(t[0]){var n=t[0];$(".context-menu").remove(),$.ajax({type:"POST",url:"/Views/MasterData/VATCodeList.aspx/GetVATPercWF",data:"{iId: '"+n+"'}",contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){var t=e.d;if(null!==t){var n=parseFloat(t),i=uxLineList.GetEditor(s[1]),o=0;null!=i.GetValue()&&(o=i.GetValue());var r=uxLineList.GetEditor(s[2]);if(null!=n||""!=n){var a=o*n;r.SetValue(a)}}uxLineList.FocusEditor("Percentage")}})}else $("#"+s[0]).focus()}function OnChangeAmountWF(){var e="uxVatPercentage",t=$("#"+e+"Value").val().split(",");if(t[0]){var n=t[0];$(".context-menu").remove(),$.ajax({type:"POST",url:"/Views/MasterData/VATCodeList.aspx/GetVATPercWF",data:"{iId: '"+n+"'}",contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){var t=e.d;if(null!==t){var n=uxLineList.GetEditValue("Amount"),i=parseFloat(t);uxLineList.SetEditValue("VAT",n*i);uxLineList.GetEditValue("VAT")}}})}else $("#"+e).focus()}function OnChangeAccount(n){var e=$("#"+n+"Value").val().split(",");if(e[0]){var t=e[0];e[1];$(".context-menu").remove(),$.ajax({type:"POST",url:"/Views/Banks/BankEntry.aspx/GetAccountData",data:"{id: '"+t+"'}",contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){var t=e.d;if(null!==t)t.split(","),uxLineList.GetEditor(n[0]);$("#uxOutstanding").focus()}})}else $("#"+n).focus()}function IsSearchBoxEmpty(e,t){return""!=$("#"+t.id+"Value").val().split(",")[0]}function HideDivSubTitle(){$(".fieldgroup .panel-default").each(function(e,t){0===$(t).find(".panel-body").children("div:visible").length&&$(t).hide()})}var ListPage={ShowEdit:function(e,t){window.location=0===t?e+".aspx":e+".aspx?id="+t},ShowPopUpNotification:function(e,t){e.GetSelectedRowCount()<1?popupNotification.Show():"delete"===t?popupDelete.Show():e.PerformCallback(t)},HandleCallbackAction:function(e,t){void 0===e&&"refresh"===t?location.reload():$("#form1").valid()&&e.PerformCallback(t)},HideParentWindow:function(e,t){e.cpHideParentWindow?window.location=t:SetButtonsEnabled(!0)}},EditPage={HandleButtonAction:function(e,t,n){SetButtonsEnabled(!1),void 0!==e&&e.GetEnabled()?"Cancel"===n||$("#form1").valid()&&ASPxClientEdit.AreEditorsValid()?e.PerformCallback(n):SetButtonsEnabled(!0):window.location=t},HideParentWindow:function(e,t,n){if(e.cpHideParentPopup)if(null!=n)window.parent.$("#popup_"+n).dialog("close");else{var i=WebUtil.GetParameterByName("dialogid");i&&window.parent.$("#popup_"+i).dialog("close")}else e.cpHideParentWindow?window.location=t:SetButtonsEnabled(!0)}},WebUtil={SetCookie:function(e,t,n){var i=new Date;i.setDate(i.getDate()+n);var o=escape(t)+(null==n?"":";expires="+i.toUTCString()+"; path=/");document.cookie=e+"="+o},GetCookie:function(e){var t,n,i,o=document.cookie.split(";");for(t=0;t<o.length;t++)if(n=o[t].substr(0,o[t].indexOf("=")),i=o[t].substr(o[t].indexOf("=")+1),(n=n.replace(/^\s+|\s+$/g,""))===e)return unescape(i)},GetParameterByName:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null==t?"":decodeURIComponent(t[1].replace(/\+/g," "))},ClosePdfViewer:function(){var e=WebUtil.GetCookie("exe_ViewerHasOpen");null!=e&&""!==e&&"true"===e&&WebUtil.SetCookie("exe_ViewerClose",!0,1)},OpenPdfViewer:function(e,t,n,i,o){var r=WebUtil.GetCookie("exe_ViewerHasOpen"),a=e.split(";");if(null==r||""===r||"false"===r){window.open("/Views/Util/PdfViewer.aspx?id="+a[0]+"&companyId="+a[1]+(2<a.length?"&imgId="+a[2]:""),"","width="+n+",height="+t+",titlebar=no,location=no,menubar=no,status=yes,toolbar=no,scrollbars=yes,resizable=yes");WebUtil.SetCookie("exe_ViewerHasOpen",!0,1),WebUtil.SetCookie("exe_ViewerFileName",e,1)}else WebUtil.SetCookie("exe_ViewerFileName",e,1)},OpenPdfViewerDirect:function(e,t,n,i,o){window.open(e,"","width="+n+",height="+t+",titlebar=no,location=no,menubar=no,status=yes,toolbar=no,scrollbars=yes,resizable=yes")},CheckFilePageStatus:function(){var e=WebUtil.GetCookie("exe_ViewerHasOpen");if(null!=e&&""!==e&&"true"===e){var t=WebUtil.GetCookie("exe_CheckViewerStatus");null==t||""===t||"2"===t?WebUtil.SetCookie("exe_CheckViewerStatus","1",1):WebUtil.SetCookie("exe_ViewerHasOpen",!1,1)}},ResizeWindow:function(e,t,n){var i=window.innerWidth-t-n;n>window.innerWidth/2&&(i=n),window.resizeTo(i,window.outerHeight),n<window.innerWidth/2?n+=t:n=0,window.moveTo(n,0)}},GlobalUtils={Notify:function(e){e&&e.forEach(function(e){$.notify(e.Text,NotifyHelpers.GetOptionsForStyle(e.Style))})},GetUrlParamsAsJson:function(e){var t;if(e){var n=location.href.indexOf("?");if(-1==n)return[];t=location.href.substr(n+1)}else t=location.search.substr(1);var a={};return t.split("&").forEach(function(e){if(e){var t=e.split("="),n=t[0],i=n.indexOf("[");if(-1==i)a[n]=decodeURIComponent(t[1]);else{var o=n.indexOf("]"),r=n.substring(i+1,o);n=n.substring(0,i),a[n]||(a[n]=[]),r?a[n][r]=t[1]:a[n].push(t[1])}}}),a},GetCountry:function(){if(window.XMLHttpRequest?xmlhttp=new XMLHttpRequest:xmlhttp=new ActiveXObject("Microsoft.XMLHTTP"),xmlhttp.open("GET"," http://api.hostip.info/get_html.php ",!1),xmlhttp.send(),hostipInfo=xmlhttp.responseText.split("n"),0<hostipInfo.length)for(i=0;hostipInfo.length>=i;i++)if(hostipInfo[i]&&0<hostipInfo[i].indexOf(":")&&(ipAddress=hostipInfo[i].split(":"),"country_code"==ipAddress[0]))return ipAddress[1];return!1},ParseDate:function(e){if(!e)return e;var t=(new Date).getTimezoneOffset()/60,n=t<0?"+":"-";e instanceof Date&&(e=e.getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2));return e.substring(0,10)+"T00:00:00"+n+("0"+Math.abs(t)).slice(-2)+":00"}};Number.prototype.round=function(e){return+(Math.round(this+"e+"+e)+"e-"+e)};var exeApp,gridviewUtil={InitStyleClasses:function(){$(".dxgvTable").addClass("table table-striped table-hover table-condensed")}};function validElementString(e){try{return 0!==angular.element(e).length}catch(e){return!1}}exeApp.directive("ngButtonConfig",function(){return{link:function(e,t,n){var i=n.id.split("_");0==e.buttonConfig[i[i.length-1]]?t.hide():1==e.buttonConfig[i[i.length-1]]&&n.$set("disabled","disabled")}}}),exeApp.directive("ngConfirmOnExit",function(){return{link:function(i,e,t){$(window).bind("beforeunload",function(e){if(i.checkChanges(),i.hasChanges&&(void 0===i.action||!i.action||"cancel"==i.action))return i.$apply(function(){i.performingAction=!1}),"You've made changes."}),i.linesToCompare=angular.copy(i[t.linesToWatch]),i.toCompare=angular.copy(i[t.ngConfirmOnExit]),i.periodToCompare=angular.copy(i.period),i.checkChanges=function(){if(i.hasChanges=!1,angular.forEach(i[t.ngConfirmOnExit],function(e,t){if(""!=e&&e!=i.toCompare[t]){if(!i.needsParsing[t])return void(i.hasChanges=!0);if(1==i.needsParsing[t]&&i.toCompare[t].toLocaleDateString()!=e.toLocaleDateString())return void(i.hasChanges=!0)}}),i[t.linesToWatch].length==i.linesToCompare.length){var n=0;angular.forEach(i[t.linesToWatch],function(e){angular.forEach(e,function(e,t){if(-1==o.indexOf(t)&&""!=e&&e!=i.linesToCompare[n][t]){if(!i.needsParsing[t])return void(i.hasChanges=!0);if(1==i.needsParsing[t]&&i.linesToCompare[n][t].toLocaleDateString()!=e.toLocaleDateString())return void(i.hasChanges=!0)}}),n++})}else i.hasChanges=!0;angular.forEach(i.period,function(e,t){""==e||e==i.periodToCompare[t]||(i.hasChanges=!0)})};var o=["$$hashKey","WriteOffCode"]}}}),exeApp.controller("TranslationCtrl",["$scope","$uibModalInstance","languages",function(e,t,n){e.languages=n,e.template=angular.copy(e.languages),e.Save=function(){t.close(e.languages)},e.Dismiss=function(){t.close(e.template)}}]),exeApp.directive("ngTranslationControl",["$uibModal",function(i){return{link:function(n,e,t){n.updateValues=function(e){n.languages[e].Text=n.userControl[e].Description},n.translate=function(t){i.open({templateUrl:"translationControl",controller:"TranslationCtrl",resolve:{languages:function(){return n.languages}}}).result.then(function(e){null!=e&&(n.languages=e,document.getElementById(t).value=null==n.languages[n.translationIndex].Text?$scope.languages[1].Text:n.languages[n.translationIndex].Text)})}}}}]),exeApp.controller("PopupOurReferenceCtrl",function(i,t,e,n,o,r,a,s,l,c,u){i.glAccount=r,i.account=a,i.accounts=l,i.glAccounts=s,i.ourRefs=c,i.isValid=!0,angular.forEach(i.ourRefs,function(e){e.balance=angular.copy(e.AmountBalance)}),i.OurRefTable=new e({page:1,count:10,sorting:{SortSeq:"asc"}},{total:i.ourRefs.length,getData:function(e){var t=i.ourRefs;angular.forEach(t,function(e){switch(e.$selected=!1,e.InvoiceDate=o("date")(e.InvoiceDate,"shortDate"),e.JournalType){case 0:e.JournalTypeDescription=u.sales;break;case 1:e.JournalTypeDescription=u.purchase;break;case 2:e.JournalTypeDescription=u.bank}});var n=e.sorting()?o("orderBy")(t,e.orderBy()):t;return n=e.filter()?o("filter")(n,e.filter()):n,e.total(n.length),n.slice((e.page()-1)*e.count(),e.page()*e.count())}}),i.save=function(){var e=o("filter")(i.ourRefs,{$selected:!0});angular.forEach(e,function(e){(0==e.balance||null==e.balance||isNaN(e.balance))&&(i.isValid=!1,e.exceed=!0)}),i.isValid&&t.close(e)},i.cancel=function(){t.close(null)},i.validate=function(e,t,n){t<n?(i.exceed=!0,e.exceed=!0):(e.exceed=!1,i.exceed=!1)}}),exeApp.controller("InvoiceHistoryPopupCtrl",function(r,e,a,i,t,n,o){r.labels=n,r.historyList=t,angular.forEach(r.historyList,function(e){e.sInvoiceDate=a("date")(e.InvoiceDate,"shortDate")}),r.dismiss=function(){e.close("cancel")},r.list=new o({page:1,count:10,sorting:{InvoiceDate:"desc"}},{total:r.historyList.length,getData:function(e){var t=e.filter()?a("filter")(r.historyList,e.filter()):r.historyList,n=e.sorting()?a("orderBy")(t,e.orderBy()):t,i=angular.copy(e.filter());for(var o in i)""!==i[o]&&null!==i[o]||delete i[o];return n=i?a("filter")(n,i):n,e.total(n.length),n.slice((e.page()-1)*e.count(),e.page()*e.count())}}),r.openEntry=function(e){if(angular.forEach(r.history,function(e){e.$selected=!1}),e.$selected=!0,e.IsPurchase){var t="/Views/Purchase/PurchaseEntry.aspx#/edit/",n={};n.From=window.location.href,n.Close=!0,window.open(t+e.Id+"?"+$.param(n))}else{var i=(t="/Views/Sales/SalesEntry.aspx")+"?id="+e.Id+"&journalid="+e.fk_journal_id+"&periodid="+e.fk_periodentry_id+"&close=true";window.open(i)}},r.translate=function(t){t.TranslatedGLAccountDescription=t.GLAccountCodes;var e=a("equalFilter")([{id:1,code:"en"},{id:2,code:"nl"},{id:3,code:"fr"},{id:4,code:"de"},{id:5,code:"lv"},{id:6,code:"ru"},{id:7,code:"en"}],{id:preloadedData.User.LanguageId}),n="https://translate.yandex.net/api/v1.5/tr.json/translate?key={key}&text={text}&lang={lang}".replace("{key}","trnsl.1.1.20151203T051244Z.3fc0892b53bf94b8.7f9ef68f31d6f150d2d80598fcdfe4781a64edae").replace("{text}",encodeURI(t.GLAccountCodes)).replace("{lang}","nl-"+e[0].code);i.post(n).then(function(e){t.TranslatedGLAccountDescription=e.data.text[0]})}}),exeApp.controller("CustomizationCtrl",["$scope","$uibModalInstance","$filter","$http","fields","page",function(r,a,e,i,t,n){r.fields=t,r.page=n,r.Save=function(){var n=[];$.each(r.fields,function(e,t){t.IsSelected&&n.push(t.Id)});var e=angular.extend({},{fields:angular.toJson(n)}),t={url:"/Handlers/DataHandler.ashx?type=PageConfig&page="+r.page,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)};return i(t).success(function(e,t,n,i){var o=e;o.Messages&&GlobalUtils.Notify(o.Messages),o.IsError?r.performingAction=!1:a.close("save")}).error(function(e,t,n,i){r.performingAction=!1;var o=[{Style:"GlobalDanger",Text:"HTTP "+t+" Error. Please contact the administrator."}];GlobalUtils.Notify(o)})},r.Dismiss=function(){a.close("cancel")}}]),exeApp.controller("PopupCtrl",["$scope","$uibModalInstance","$http","$filter","message",function(e,t,n,i,o){e.deletemessage=o||LocalizationStrings.GlobalMsgConfirmDelete,e.approvemessage=o||LocalizationStrings.MsgConfirmDeliveryNote,e.Dismiss=function(){t.close("cancel")},e.Delete=function(){t.close("delete")},e.ApproveAll=function(){t.close("ApproveAll")}}]),exeApp.controller("DuplicateCtrl",["$scope","$uibModalInstance","duplicates","info",function(e,t,n,i){e.duplicates=n,e.info=i,e.Save=function(){t.close("yes")},e.Dismiss=function(){t.close("cancel")},e.Edit=function(e){t.close(e)}}]),exeApp.controller("bookingPopupCtrl",["$scope","$uibModalInstance","bookingData","showVatReturn",function(e,t,n,i){e.showVatReturn=i,e.bookingData=n,e.preloadedData=preloadedData,e.Dismiss=function(){t.close("cancel")},e.close=function(){t.close("Ok")}}]),window.angular.module("exeApp").directive("summaryPanel",function(){return{scope:{sumaries:"="},controller:["$scope",function(t){t.VisibleClass=t.sumaries&&0<t.sumaries.length?"well":"",t.GetWidth=function(){var e=t.sumaries?t.sumaries.length:0;return(0<e?100/e:0)+"%"}}],template:'<div class="{{VisibleClass}}">   <div ng-repeat="item in sumaries" class="summary-panel" ng-style="{width: GetWidth()}" >     <div class="panel {{item.CssClass}}">         <div class="panel-heading">             <h3 class="panel-title">{{item.Title}}</h3>          </div>          <div class="panel-body">              <h2>{{item.Value}}</h2>          </div>      </div>   </div></div>'}}),window.angular.module("exeApp").directive("searchbox",function(){return{scope:{hasValue:"=",showSearchButton:"=",showEditButton:"=",disabled:"=",placeholder:"@",cssclass:"@",type:"@"},controller:["$scope","$http",function(i,t){i.getSearchBtnDisplayStyle=i.showSearchButton?"block":"none",i.getEditBtnDisplayStyle=i.showEditButton?"inline-block":"none",i.editIcon=i.selectedItem&&i.selectedItem.Value?"glyphicon glyphicon-pencil":"glyphicon glyphicon-plus",i.SelectedItem={Code:"",Description:"",Value:""},i.hasValue,i.searchValues=function(e){return t.get("/Handlers/SearchHandler.ashx",{params:{query:e,type:i.type}}).then(function(e){var t=[];return e.data.forEach(function(e){t.push(e)}),t})},i.onItemSelect=function(e,t,n){i.SelectedItem=e,$("#"+i.getValueId+"Value")},i.someMethod=function(){i.callback(i.param)}}],templateUrl:"/Assets/html/searchbox-template.html"}}),angular.module("exeApp").factory("SearchService",function(l){return getSearchValues=function(e,t,n,i,o,r,a,s){return l.get("/Handlers/SearchHandler.ashx",{params:{query:e,type:t,none:n,addNew:i,link:o,level:r,filter:a,showAll:s}}).then(function(e){return e.data})},getSingleData=function(e,t,n,i,o,r){if(!isNaN(e)){var a={params:{id:e,type:t,addNew:n,link:i,filter:o,text:r}};return l.get("/Handlers/SearchHandler.ashx",a).then(function(e){return e.data})}},formEditUrl=function(e,t){return t?e+"?id="+t:url},function(){this.getJournals=function(e){return getSearchValues(e,"IBA.Library.Controls.JournalSearchBox")},this.getBankJournals=function(e){return getSearchValues(e,"IBA.Library.Controls.BankJournalSearchBox")},this.getPeriodYear=function(e){return getSearchValues(e,"IBA.Library.Controls.PeriodYearSearchBox")},this.getPeriodEntry=function(e){return getSearchValues(e,"IBA.Library.Controls.PeriodEntrySearchBox")},this.getVATPeriod=function(e){return getSearchValues(e,"IBA.Library.Controls.PeriodYearSearchBox")},this.getGLAccounts=function(e,t,n,i,o){return i=i||0,getSearchValues(e,"IBA.Library.Controls.GLAccountSearchBox",n||!1,t||!1,"/Views/MasterData/GLAccountEdit.aspx",null,i,o||!1)},this.getAnalyticals=function(e){return getSearchValues(e,"IBA.Library.Controls.AnalyticalSearchBox")},this.openGLAccount=function(e){window.open(formEditUrl("/Views/MasterData/GLAccountEdit.aspx",e))},this.openDepreciation=function(e){window.open(formEditUrl("/Views/MasterData/DepreciationMethodEdit.aspx",e))},this.getAccounts=function(e,t){return getSearchValues(e,"IBA.Library.Controls.AccountSearchBox",t||!1)},this.openAccount=function(e){window.open(formEditUrl("/Views/MasterData/SupplierCustomerEdit.aspx",e))},this.getClassifications=function(e){return getSearchValues(e,"IBA.Library.Controls.ClassificationSearchBox")},this.openClassification=function(e){window.open(formEditUrl("/Views/MasterData/ClassificationEdit.aspx",e))},this.getCostCentres=function(e){return getSearchValues(e,"IBA.Library.Controls.CostCentreSearchBox")},this.openCostCentre=function(e){window.open(formEditUrl("/Views/MasterData/AnalyticalEdit.aspx?costcentre=true",e))},this.getCostUnits=function(e){return getSearchValues(e,"IBA.Library.Controls.CostUnitSearchBox")},this.openCostUnit=function(e){window.open(formEditUrl("/Views/MasterData/AnalyticalEdit.aspx?costcentre=false",e))},this.getCustomers=function(e,t){return getSearchValues(e,"IBA.Library.Controls.CustomerSearchBox",!1,t||!1,"/Views/MasterData/CustomerEdit.aspx")},this.openCustomer=function(e){window.open(formEditUrl("/Views/MasterData/CustomerEdit.aspx",e))},this.getDocuments=function(e){return getSearchValues(e,"IBA.Library.Controls.DocumentSearchBox",!0)},this.openDocument=function(e){window.open(formEditUrl("/Views/MasterData/ExchangeRateEdit.aspx",e))},this.getOutstandingItems=function(e,t){return getSearchValues(e,"IBA.Library.Controls.OutstandingItemSearchBox",t||!1)},this.getReferences=function(e){return getSearchValues(e,"IBA.Library.Controls.ReferenceSearchBox")},this.getPaymentConditions=function(e,t){return getSearchValues(e,"IBA.Library.Controls.PaymentConditionSearchBox",!1,t||!1,"/Views/MasterData/PaymentCondEdit.aspx")},this.openPaymentCondition=function(e){window.open(formEditUrl("/Views/MasterData/PaymentCondEdit.aspx",e))},this.getPurchaseJournals=function(e){return getSearchValues(e,"IBA.Library.Controls.PurchaseJournalSearchBox")},this.getPurchaseOrderJournals=function(e){return getSearchValues(e,"IBA.Library.Controls.PurchaseOrderJournalSearchBox")},this.getSalesJournals=function(e){return getSearchValues(e,"IBA.Library.Controls.SalesJournalSearchBox")},this.getSalesOrderJournals=function(e){return getSearchValues(e,"IBA.Library.Controls.SalesOrderJournalSearchBox")},this.getSectors=function(e,t){return getSearchValues(e,"MFP.Library.Controls.SectorSearchBox",!1,!1,!1,void 0,void 0,t||!1)},this.getSuppliers=function(e,t){return getSearchValues(e,"IBA.Library.Controls.SupplierSearchBox",!1,t||!1,"/Views/MasterData/SupplierEdit.aspx")},this.openSupplier=function(e){window.open(formEditUrl("/Views/MasterData/SupplierEdit.aspx",e))},this.getVATCodes=function(e){return getSearchValues(e,"IBA.Library.Controls.VATCodeSearchBox")},this.openVATCode=function(e){window.open(formEditUrl("/Views/MasterData/VATCodeEdit.aspx",e))},this.getVATPercentages=function(e){return getSearchValues(e,"IBA.Library.Controls.VATPercentageSearchBox")},this.getPeriodEntries=function(e){return getSearchValues(e,"IBA.Library.Controls.PeriodEntrySearchBox")},this.getPeriodYears=function(e){return getSearchValues(e,"IBA.Library.Controls.PeriodYearSearchBox")},this.getVATPeriodEntries=function(e){return getSearchValues(e,"IBA.Library.Controls.VATPeriodEntrySearchBox")},this.openVATPercentage=function(e){window.open(formEditUrl("/Views/MasterData/VATPercEdit.aspx",e))},this.getCompanies=function(e){return getSearchValues(e,"MFP.Library.Controls.CompanySearchBox")},this.getCountries=function(e){return getSearchValues(e,"MFP.Library.Controls.CountrySearchBox")},this.getAllCompanies=function(e){return getSearchValues(e,"MFP.Library.Controls.SearchCompaniesBox")},this.getCompanyById=function(e){return getSingleData(e,"MFP.Library.Controls.SearchCompaniesBox")},this.getCurrencies=function(e){return getSearchValues(e,"MFP.Library.Controls.CurrencySearchBox")},this.getDepartments=function(e){return getSearchValues(e,"MFP.Library.Controls.DepartmentSearchBox")},this.getLanguages=function(e){return getSearchValues(e,"MFP.Library.Controls.LanguageSearchBox")},this.getProfileOrgDepartments=function(e,t){return getSearchValues(e,"MFP.Library.Controls.ProfileOrgDepartmentSearchBox",t||!1)},this.getUsers=function(e,t){return getSearchValues(e,"MFP.Library.Controls.UserSearchBox",t||!1)},this.openUser=function(e){window.open(formEditUrl("/Views/MasterData/UserEdit.aspx",e))},this.getVatReturnBoxes=function(e){return getSearchValues(e,"IBA.Library.Controls.VATReturnSearchBox")},this.getGLAccountClassifications=function(e,t){return getSearchValues(e,"IBA.Library.Controls.GLAccountClassificationSearchBox",!1,!1,"/Views/MasterData/GLAccountClassificationEdit.aspx")},this.getGLAccountScheme=function(e){return getSearchValues(e,"IBA.Library.Controls.GLAccountSchemeSearchBox")},this.openGLAccountScheme=function(e){window.open(formEditUrl("/Views/MasterData/GLAccountSchemeEdit.aspx",e))},this.getGLAccountClass=function(e){return getSearchValues(e,"IBA.Library.Controls.GLAccountClassSearchBox")},this.getGeneralJournals=function(e){return getSearchValues(e,"IBA.Library.Controls.GeneralJournalSearchBox")},this.getOutstandingItems=function(e,t){return getSearchValues(e,"IBA.Library.Controls.OutstandingItemSearchBox",t||!1)},this.getSingleAnalytical=function(e){return getSingleData(e,"IBA.Library.Controls.AnalyticalSearchBox")},this.getSingleSupplier=function(e){return getSingleData(e,"IBA.Library.Controls.SupplierSearchBox")},this.getSingleGLAccount=function(e,t){return t=t||0,getSingleData(e,"IBA.Library.Controls.GLAccountSearchBox",null,null,t)},this.getSingleCustomer=function(e){return getSingleData(e,"IBA.Library.Controls.CustomerSearchBox")},this.getSingleCompany=function(e){return getSingleData(e,"MFP.Library.Controls.CompanySearchBox")},this.getSingleAccount=function(e){return getSingleData(e,"IBA.Library.Controls.AccountSearchBox")},this.getSingleUser=function(e){return getSingleData(e,"MFP.Library.Controls.UserSearchBox")},this.getSingleSector=function(e){return getSingleData(e,"MFP.Library.Controls.SectorSearchBox")},this.getBankDetails=function(e,t){return getSingleData(e,"IBA.Library.Controls.BankDetailSearchBox",t||!1,"/Views/MasterData/BankDetailEdit.aspx?accountId="+e)},this.getSingleVATPerc=function(e){return getSingleData(e,"MFO.Library.Controls.VATPercentageSearchBox")},this.getAccountProposal=function(e,t){t=t||0;return getSearchValues(e,"IBA.Library.Controls.AccountProposalSearchBox",!1,!1,"",null,t)},this.getSingleDepartment=function(e){return getSingleData(e,"MFP.Library.Controls.ProfileOrgDepartmentSearchBox")},this.getTitle=function(e){return getSearchValues(e,"IBA.Library.Controls.TitleSearchBox")},this.getRoboticMaintenanceText=function(e,t,n,i){return getSingleData(e,"MFP.Library.Controls.RoboticMaintenanceDescriptionSearchBox",!1,"",n,i)}}}),(exeApp=angular.module("exeApp")).filter("propsFilter",function(){return function(e,a){var s=[];return angular.isArray(e)?e.forEach(function(e){for(var t=!1,n=Object.keys(a),i=0;i<n.length;i++){var o=n[i],r=a[o].toLowerCase();if(null!=e[o]&&-1!==e[o].toString().toLowerCase().indexOf(r)||-1==e.Id){t=!0;break}}t&&s.push(e)}):s=e,s}}),(exeApp=angular.module("exeApp")).filter("equalFilter",function(){return function(e,r){var a=[];return angular.isArray(e)?e.forEach(function(e){for(var t=!1,n=Object.keys(r),i=0;i<n.length;i++){var o=n[i];if(null!=e[o]&&e[o]==r[o]||-1==e.Id){t=!0;break}}t&&a.push(e)}):a=e,a}}),exeApp.filter("notInArray",function(t){return function(e,n,i){if(n)return t("filter")(e,function(e){for(var t=0;t<n.length;t++)if(n[t][i]==e[i])return!1;return!0})}}),exeApp.directive("ngFinancialPeriod",function(){return{link:function(r,e,t){r.periodSelected=null,r.period={},r.$watch("periodId",function(e){e&&(r.periodId=e,getPeriod())},!0),updatePeriod=function(e){var t="(Period is close)";r.nextEnabled=!0,r.previousEnabled=!0,r.period=r.periods[r.periodSelected],null==r.periods[r.periodSelected+1]&&(r.nextEnabled=!1),null==r.periods[r.periodSelected-1]&&(r.previousEnabled=!1),r.period?(r.period.PeriodStatus=null,r.period.PeriodDate=null,"0"==r.period.Status&&(t="(Period is open)"),r.period.PeriodDate="("+r.period.StartDate+" - "+r.period.EndDate+")",r.period.PeriodStatus=t,r.periodId=r.period.Id,"function"==typeof r.getPeriod&&r.getPeriod(r.period)):r.nextEnabled=!1},getPeriod=function(){var t=0;angular.forEach(r.periods,function(e){if(e.Id==r.periodId)return r.periodSelected=t,r.period.periodIsOpen="0"==r.period.Status,void updatePeriod(!1);t++})},r.next=function(e){r.periodSelected=e+1,updatePeriod(!0),r.period.Year&&r.period.Month&&(r.onPeriodChanged,r.onPeriodChanged(r.period.Year,r.period.Month,!0))},r.previous=function(e){r.periodSelected=e-1,updatePeriod(!0),r.period.Year&&r.period.Month&&(r.onPeriodChanged,r.onPeriodChanged(r.period.Year,r.period.Month,!0))},getPeriod(),r.nextYear=function(e){if(r.period.Year&&r.period.Month){var t=r.period.Year+1,n=!1,i=0,o=0;angular.forEach(r.periods,function(e){e.Year==t&&e.Month==r.period.Month&&(r.periodSelected=o,n=!0),e.Year==t&&0==i&&(i=o),o++}),n||(r.periodSelected=i),updatePeriod(!0),r.onPeriodChanged,r.onPeriodChanged(r.period.Year,r.period.Month,!0)}},r.previousYear=function(e){if(r.period.Year&&r.period.Month){var t=r.period.Year-1,n=0,i=!1,o=0;angular.forEach(r.periods,function(e){e.Year==t&&e.Month==r.period.Month&&(r.periodSelected=o,i=!0),e.Year==t&&0==n&&(n=o),o++}),i||(r.periodSelected=n),updatePeriod(!0),r.onPeriodChanged,r.onPeriodChanged(r.period.Year,r.period.Month,!0)}}}}}),exeApp.filter("ellipsis",function(){return function(e,t){return t=null==t?50:t,e&&e.length>t?e.substr(0,t)+"...":e}}),exeApp.filter("vatSalesFilter",function(){var a=[1,11,21,22,23,24,44,57],s=[1,11,21,22,23,24,44,51,52,53,54,55,56,57],l=[1,11,21,22,23,24,44,71],c=[22,23,24],u=[{Code:1,VatPercentages:[{Code:0,SalesNormal:"00",SalesCredit:"49"},{Code:.06,SalesNormal:"01",SalesCredit:"49"},{Code:.12,SalesNormal:"02",SalesCredit:"49"},{Code:.21,SalesNormal:"03",SalesCredit:"49"}]},{Code:11,VatPercentages:[{Code:0,SalesNormal:"54",SalesCredit:"49"}]},{Code:21,VatPercentages:[{Code:0,SalesNormal:"45",SalesCredit:"49"}]},{Code:44,VatPercentages:[{Code:0,SalesNormal:"00",SalesCredit:"49"}]},{Code:51,VatPercentages:[{Code:0,SalesNormal:"46",SalesCredit:"48"}]},{Code:56,VatPercentages:[{Code:0,SalesNormal:"47",SalesCredit:"48"}]},{Code:57,VatPercentages:[{Code:0,SalesNormal:"44",SalesCredit:"48"}]},{Code:2,VatPercentages:[{Code:0,SalesNormal:"45",SalesCredit:"49"}]},{Code:"",VatPercentages:null,SalesNormal:"47",SalesCredit:"49"}];return function(e,t,n,i,o){var r=[];if("list"==n){r="BE"==o.trim()?a:"EU"==o.trim()?s:l}else"default"==n?(angular.forEach(u,function(e){e.Code.toString().trim()==t&&(r=e)}),0==r.length&&-1==c.indexOf(t)&&(r=u[u.length-1])):(angular.forEach(u,function(e){e.Code.toString().trim()==t&&(null!=e.VatPercentages?angular.forEach(e.VatPercentages,function(e){e.Code==i&&(r=e)}):r=e)}),0==r.length&&(r=u[u.length-1]));return r}}),exeApp.filter("countryTypeFilter",function(){var n=["AT","HR","BG","CZ","DK","EE","FI","FR","GR","HU","IE","IT","LV","LT","LU","MT","PO","RO","SK","SI","SE","CY","DE","NL","PT","ES","GB","BE"];return function(e,t){return null==t?"outside":"BE"==t.trim()?"BE":"EU"==t.trim()?"EU":-1!=n.indexOf(t.trim())?"EU":"outside"}}),exeApp.directive("ngRedirect",["$parse",function(i){return{restrict:"A",require:"?ngModel",link:function(e,t,n){e.$watch(n.ngRedirect,function(e){i(n.ngModel),n.ngModel.split(".");void 0!==e&&null!=e&&window.open(e)})}}}]),exeApp.directive("ngNumber",function(){return{require:"ngModel",link:function(e,t,n,i){i.$parsers.push(function(e){if(null==e)return"";var t=e.replace(/[^0-9\.\/\\*\\\+\\\\-]/g,"");return t!=e&&(i.$setViewValue(t),i.$render()),t})}}}),exeApp.directive("ngEnter",function(){return function(t,e,n){e.bind("keydown keypress",function(e){113===e.which&&(t.$apply(function(){t.$eval(n.ngEnter)}),e.preventDefault())})}}),exeApp.directive("dateValidator",function(e){return{require:"ngModel",link:function(e,t,n,o){e.$watch(function(){return o.$viewValue},function(e){var t=preloadedData.User.Locale||preloadedData.User.LanguageId,n=new RegExp(function(e){var t="";switch(e){case"2":case"nl-NL":t=/^(0[1-9]|1\d|2\d|3[01])-(0[1-9]|1[0-2])-([0-9]{2})$/;break;case"3":case"fr-FR":t=/^(0[1-9]|1\d|2\d|3[01])\/(0[1-9]|1[0-2])\/([0-9]{4})$/;break;case"4":case"de-DE":case"5":case"lv-LV":case"6":case"ru-RU":t=/^(0[1-9]|1\d|2\d|3[01]).(0[1-9]|1[0-2]).([0-9]{2})$/;break;default:t=/^(0[1-9]|1\d|2\d|3[01])-(0[1-9]|1[0-2])-([0-9]{2})$/}return t}(t));if(void 0!==e&&null!=e&&""!=e)if(o.$setValidity("badDate",!0),e instanceof Date){var i=Date.parse(e);isNaN(i)&&o.$setValidity("badDate",!1)}else""==e||n.test(e)||o.$setValidity("badDate",!1);else o.$setValidity("badDate",!1)})}}}),exeApp.filter("codeDescriptionFilter",function(){return function(e,t){var n=[];return void 0===t||""===t?e:(e&&e.forEach(function(e){isNaN(t[0])?e.Description&&(-1==e.Description.toString().toLowerCase().indexOf(t)&&-1==e.Description.toString().toUpperCase().indexOf(t)||n.push(e)):0==e.Code.indexOf(t)&&n.push(e)}),n)}}),exeApp.filter("codeFirmNameFilter",function(){return function(e,t){var n=[];return void 0===t||""===t?e:(e&&e.forEach(function(e){isNaN(t[0])?e.FirmName&&(-1==e.FirmName.toString().toLowerCase().indexOf(t)&&-1==e.FirmName.toString().toUpperCase().indexOf(t)||n.push(e)):0==e.Code.indexOf(t)&&n.push(e)}),n)}}),exeApp.filter("dateParser",function(){return function(e){if(!e)return e;var t="T00:00:00.000Z";e instanceof Date&&(e=e.getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2)+t);return"string"==typeof e&&(e=e.substring(0,10)+t),e}}),exeApp.filter("unique",function(){return function(e,t){var n,i={},o=e.length,r=[];for(n=0;n<o;n+=1)i[e[n][t]]=e[n];for(n in i)r.push(i[n]);return r}}),angular.module("exeApp").factory("RequestDataService",["$http",function(i){return getValue=function(e,t,n){return i.get("/Handlers/RequestDataHandler.ashx",{params:{page:e,type:t,isFromModel:n}}).then(function(e){return e.data})},function(){this.getNewAccount=function(){return getValue("Account","NewId",!0)},this.getNewGLAccount=function(){return getValue("GLAccount","NewId",!0)},this.getNewPaymentCondition=function(){return getValue("PaymentCondition","NewId",!0)},this.getNewItem=function(){return getValue("Item","NewId",!0)},this.getNewBank=function(){return getValue("Bank","NewId",!0)}}}]),exeApp.filter("percentage",["$filter",function(n){return function(e,t){if(e||!(e<0))return n("number")(100*e,t)+"%"}}]),exeApp.directive("ngHomepage",function(){return{link:function(e,t,n){console.log(homePage)}}}),exeApp.controller("PopupUpdateEntryCtrl",["$scope","$uibModalInstance","journalList","bookPeriods","vatPeriods","isWithVat","btnConfig",function(n,e,t,i,o,r,a){n.journalList=t,n.data={fk_journal_id:null},n.isWithVat=r,n.btnConfig=a,n.cancel=function(){e.close(null)},n.originalBookPeriods=i,n.originalVATPeriods=o,n.bookPeriods=angular.copy(n.originalBookPeriods),n.vatPeriods=angular.copy(n.originalVATPeriods),n.data=[],n.data.fk_periodbook_id=null,n.data.fk_periodvat_id=null,n.onJournalChanged=function(e){n.data.fk_journal_id=e.Id},n.onBookPeriodChanged=function(t){n.vatPeriods=[],angular.forEach(n.originalVATPeriods,function(e){e.StartDate<=t.StartDate&&e.EndDate>=t.EndDate&&n.vatPeriods.push(e)}),n.data.fk_periodbook_id=t.Id},n.onVATPeriodChanged=function(t){n.bookPeriods=[],angular.forEach(n.originalBookPeriods,function(e){e.StartDate>=t.StartDate&&e.EndDate<=t.EndDate&&n.bookPeriods.push(e)}),n.data.fk_periodvat_id=t.Id},n.reset=function(){n.vatPeriods=angular.copy(n.originalVATPeriods),n.bookPeriods=angular.copy(n.originalBookPeriods)},n.save=function(){e.close(n.data)}}]),exeApp.directive("ngDatepickerLocal",["$parse",function(e){return{restrict:"A",require:["ngModel"],link:function(e,t,n,i){i[0].$parsers.push(function(e){return 0==e.getHours()&&e.getTimezoneOffset()<0&&e.setMinutes(e.getMinutes()-e.getTimezoneOffset()),0==e.getHours()&&0<e.getTimezoneOffset()&&e.setMinutes(e.getMinutes()+e.getTimezoneOffset()),e})}}}]),exeApp.directive("ngAutofocus",["$timeout",function(n){return{restrict:"A",link:function(e,t){n(function(){t[0].focus()})}}}]),exeApp.filter("trim",function(){var e=[".",",","/",">","<","*","?","+","\\",'"',"'",":",";","@","#","^","_","`","~","{","}","[","]"];return function(t){return e.some(function(e){return 0<=t.indexOf(e)})&&angular.forEach(e,function(e){t=t.replace(e,"")}),t}}),exeApp.factory("TableParameters",function(e){var t=function(e){var n={};e.filters&&(n=angular.fromJson(e.filters),angular.forEach(n,function(e,t){n[t]=decodeURIComponent(e)})),this.count=e.count?e.count:25,this.filters=n,this.page=e.page?e.page:1,this.sorting=e.sorting?angular.fromJson(e.sorting):{}},n=Object.prototype.hasOwnProperty;return t.prototype={setParameters:function(e){this.count=e.count(),this.page=e.page(),this.sorting=e.sorting();var n=angular.copy(e.filter());return angular.forEach(n,function(e,t){n[t]=encodeURIComponent(e)}),this.filters=n,this},toUrl:function(e){var t=e?"&":"?",n=this.filters;return angular.forEach(n,function(e,t){n[t]=encodeURIComponent(e)}),t+"page="+this.page+"&count="+this.count+"&sorting="+angular.toJson(this.sorting)+"&filters="+angular.toJson(n)},isEmpty:function(e){if(null==this[e])return!0;if(0<this[e].length)return!1;if(0===this[e].length)return!0;for(var t in this[e])if(n.call(this[e],t))return!1;return!0}},t}),exeApp.factory("VATMatrix",function(t){var n=["AT","HR","BG","CZ","DK","EE","FI","FR","GR","HU","IE","IT","LV","LT","LU","MT","PO","RO","SK","SI","SE","CY","DE","NL","PT","ES","GB","BE"],e=function(e,t,n,i){this.isSameCountry=t.trim()==n.trim(),this.transactionType=i,this.country=t.trim(),this.vatCodes=e};return getFilteredList=function(e,t){var n=[];return angular.forEach(e,function(e){e.TransactionType!=t&&2!=e.TransactionType||n.push(e)}),n},e.prototype={getVATCodeList:function(){var e=getFilteredList(this.vatCodes,this.transactionType);return this.isSameCountry?t("filter")(e,{IsSameCountry:!0}):-1!=n.indexOf(this.country)?t("filter")(e,{IsEU:!0}):t("filter")(e,{IsNotEU:!0})},getSingleVATCode:function(e){return t("equalFilter")(this.vatCodes,{Id:e})[0]}},e}),exeApp.filter("numberPadding",function(){return function(e,t){if(t=t||0,null!=e){for(var n=""+e;n.length<t;)n="0"+n;return n}}}),exeApp.controller("PopReopen",["$scope","$uibModalInstance","$http","$filter",function(e,t,n,i){e.Dismiss=function(){t.close("cancel")},e.Save=function(e){t.close("activate")}}]),exeApp.controller("OrderCtrl",["$scope","$uibModalInstance","$http","$filter",function(e,t,n,i){e.save=function(){t.close("save")},e.close=function(){t.close("close")}}]),exeApp.controller("PopupSelectUserCtrl",["$scope","$uibModalInstance","users",function(e,t,n){e.userList=n,e.user={Id:null},e.local=LocalizationStrings,e.cancel=function(){t.close(null)},e.assign=function(){t.close(e.user)},e.onSelectAccount=function(e){}}]),exeApp.controller("PopupDuplicateWarningCtrl",function(i,e,t,n,o,r,a){i.currentDuplicates=r.current,i.openDuplicates=r.open,i.processedDuplicates=r.processed,i.balance=a,i.dups=[];var s=0;angular.forEach(i.processedDuplicates,function(e){i.dups.push(e),i.dups[s].type=1,i.dups[s].SeqNbr=i.dups[s].EntryNumber,s++}),angular.forEach(i.openDuplicates,function(e){i.dups.push(e),i.dups[s].type=2,i.dups[s].SeqNbr=i.dups[s].EntryNumber,s++}),angular.forEach(i.currentDuplicates,function(e){i.dups.push(e),i.dups[s].type=3,s++}),i.Yes=function(){e.close("yes")},i.No=function(){e.close("no")},i.sum=function(e){var t=angular.copy(i.balance),n=angular.copy(e);return t=t<0?-1*t:t,angular.forEach(n,function(e){e.Amount=e.Amount<0?-1*e.Amount:e.Amount,t-=e.Amount}),t}}),exeApp.controller("PopupSendToAccountCtrl",function(r,a,t,n,e,i){r.recipient=n.recipient,r.carbonCopy=n.carbonCopy,r.body="",r.subject="";var o={isInvoice:e,isSales:i,invoiceId:n.invoiceId};t.post("/Views/Sales/SalesInvoiceEdit.aspx/GetEmailTemplate",angular.toJson(o)).success(function(e,t,n,i){var o=angular.fromJson(e.d);o&&(r.body=o.Text,r.subject=o.Subject)}),r.cancel=function(){a.close("cancel")},r.send=function(){r.action="send",r.performingAction=!0;var e={invoiceId:n.invoiceId,email:r.recipient,cc:r.carbonCopy,body:r.body,isInvoice:n.isInvoice,isPurchase:!n.isSales,subject:r.subject};return r.carbonCopy||(e.cc=""),t.post("/Views/Sales/SalesInvoiceEdit.aspx/SendMailToAccount",angular.toJson(e)).success(function(e,t,n,i){var o=angular.fromJson(e.d);r.performingAction=!1,o.IsError&&o.Messages?GlobalUtils.Notify(o.Messages):(GlobalUtils.Notify(o.Messages),a.close("sended"))}).error(function(e,t,n,i){var o=angular.fromJson(e.d);o.IsError&&GlobalUtils.Notify(o.Messages),r.performingAction=!1})}}),exeApp.controller("PopupBankDetailsCtrl",function(i,e,o,t,n,r){i.title=r.title,i.isdefault=r.isdefault,i.close=r.close,i.data=r.data,i.tableParams=new n({page:1,count:99999999999999},{total:i.data.length,getData:function(e){var t=i.data;angular.forEach(t,function(e){e.$selected=!1});var n=e.sorting()?o("orderBy")(t,e.orderBy()):t;return n=e.filter()?o("filter")(n,e.filter()):n,e.total(n.length),n.slice((e.page()-1)*e.count(),e.page()*e.count())}}),i.cancel=function(){e.dismiss("close")}}),exeApp.controller("DisabledMesagesPopupCtrl",function(e,t,n,i,o,r,a){e.data=o,e.ask=r,e.dismiss=function(){t.close("cancel")},e.yes=function(){t.close("yes")}}),angular.module("exeApp").factory("TranslateService",function(n){return translate=function(e,t){return n.get("/Handlers/TranslateHandler.ashx",{params:{items:e,languageId:t}}).then(function(e){return e.data})},function(){this.translate=function(e,t){return translate(angular.toJson(e),t)}}}),exeApp.controller("PopupSyncPeriods",function(t,e,n,i,o){t.periods=i,t.period=o,t.cancel=function(){e.close(null)},t.onPeriodChanged=function(e){t.period=e.Id},t.save=function(){angular.forEach(n,function(e){e.SyncPeriod=t.period}),e.close(n)}}),exeApp.controller("PopupExchangeRateCtrl",function(l,e,o,t,n,c,u){l.amount=u,l.currency=c,l.exchangeRates=[],l.labels=LocalizationStrings,l.tableParams=new t({page:1,count:10},{total:l.exchangeRates.length,getData:function(e){var t=l.exchangeRates;e.sorting()&&(t=o("orderBy")(t,e.orderBy())),e.filter()&&(t=o("filter")(t,e.filter())),e.total(t.length);var n=(e.page()-1)*e.count(),i=e.page()*e.count();return t.slice(n,i)}}),$.ajax({type:"POST",url:"https://api.fixer.io/latest?base="+c,async:!0,dataType:"jsonp",crossDomain:!0,success:function(e,t,n){var i=c,o=[],r=[];for(var a in fx.rates=e.rates,fx.rates)a!=i&&o.push(a);for(var s=0;s<o.length;s++)r.push({Currency:o[s],Amount:fx(u).to(o[s])});l.exchangeRates=r,l.tableParams.reload()}}),l.close=function(){e.close()}}),exeApp.directive("ngCurrency",["$filter","$locale","$parse",function(d,p,e){return{require:"ngModel",scope:{},link:function(s,e,l,c){function a(e){return RegExp("\\d|\\-|\\"+e,"g")}function o(e){e=String(e);var t=p.NUMBER_FORMATS.DECIMAL_SEP,n=null;-1==e.indexOf(p.NUMBER_FORMATS.DECIMAL_SEP)&&-1!=e.indexOf(".")&&s.fraction&&(t=".");var i,o=d("currency")("-1",u(),s.fraction),r=RegExp("[0-9."+p.NUMBER_FORMATS.DECIMAL_SEP+p.NUMBER_FORMATS.GROUP_SEP+"]+");return o.replace(r.exec(o),"")==e.replace(r.exec(e),"")&&(e="-"+r.exec(e)),RegExp("^-[\\s]*$","g").test(e)&&(e="-0"),a(t).test(e)&&(n=(n=e.match(a(t)).join("").match((i=t,RegExp("\\-{0,1}((\\"+i+")|([0-9]{1,}\\"+i+"?))&?[0-9]{0,"+s.fraction+"}","g"))))?n[0].replace(t,"."):null),n}function u(){return angular.isDefined(s.currencySymbol)||(s.currencySymbol=""),angular.isDefined(s.currencySymbol)?s.currencySymbol:""}function t(){for(var e=c.$formatters,t=e.length,n=c.$$rawModelValue;t--;)n=e[t](n);var i=o(n);"."!=i&&"-."!=i||(i=".0"),c.$setViewValue(parseFloat(i)),c.$render()}"false"!==l.ngCurrency&&(l.$observe("min",function(e){s.min=e}),l.$observe("max",function(e){s.max=e}),l.$observe("currencySymbol",function(e){s.currencySymbol=e}),l.$observe("ngRequired",function(e){s.ngRequired=e}),l.$observe("fraction",function(e){s.fraction=e}),l.$observe("calculate",function(e){s.calculate=e}),s.fraction=void 0!==s.fraction?s.fraction:2,s.calculate=void 0===s.calculate||s.calculate,e.on("focus",function(){var e=o(c.$$rawModelValue);0==parseFloat(e)&&c.$setViewValue("")}),e.on("blur",function(){s.calculate&&function(){for(var e=c.$$rawModelValue.toString(),t=(e=(e=e.replace(/[\,]/g,".")).replace(/[^0-9\.\/\\*\\\+\\\\-]/g,"")).match(/[^\d()]+|[\d.]+/g),n=["/","*","+","-"],i=null,o=0,r=[],a=0;a<t.length;a++)"."==t[a]||"-"==t[a]&&0==a?(r.push(t[a]+t[a+1]),a++):r.push(t[a]);for(t=angular.copy(r),a=1;a<t.length;a+=2)-1!=(i=n.indexOf(t[a]))&&0!=a&&3<=t.length&&0==i&&(o=parseFloat(t[a-1])/parseFloat(t[a+1]),t[a+1]=o,t.splice(a-1,2),a=-1);for(a=1;a<t.length;a+=2)-1!=(i=n.indexOf(t[a]))&&0!=a&&3<=t.length&&1==i&&(o=parseFloat(t[a-1])*parseFloat(t[a+1]),t[a+1]=o,t.splice(a-1,2),a=-1);for(a=1;a<t.length;a+=2)-1!=(i=n.indexOf(t[a]))&&0!=a&&3<=t.length&&2==i&&(o=parseFloat(t[a-1])+parseFloat(t[a+1]),t[a+1]=o,t.splice(a-1,2),a=-1);for(a=1;a<t.length;a+=2)-1!=(i=n.indexOf(t[a]))&&0!=a&&3<=t.length&&3==i&&(o=parseFloat(t[a-1])-parseFloat(t[a+1]),t[a+1]=o,t.splice(a-1,2),a=-1);1==t.length&&(o=parseFloat(t[0])),0<t.length&&c.$setViewValue(o.round(s.fraction)),l.ngChange&&1<t.length&&(console.log(t.length),l.ngChange.split("("))}(),c.$commitViewValue(),t()}),c.$formatters.unshift(function(e){return d("currency")(e,u(),s.fraction)}),c.$validators.min=function(e){return!(s.ngRequired||!isNaN(e))||(void 0===s.min||e>=parseFloat(s.min))},s.$watch("min",function(e){c.$validate()}),c.$validators.max=function(e){return!(s.ngRequired||!isNaN(e))||(void 0===s.max||e<=parseFloat(s.max))},s.$watch("max",function(e){c.$validate()}),c.$validators.fraction=function(e){return!e||!isNaN(e)},s.$on("currencyRedraw",function(){c.$commitViewValue(),t()}),e.on("focus",function(){var e=c.$$rawModelValue;e=isNaN(e)||""===e||null==e?"":parseFloat(e).toFixed(s.fraction),c.$setViewValue(e),c.$render()}))}}}]),exeApp.directive("ngUiSelectPopupExt",["$uibModal",function(i){return{link:function(t,e,n){e.bind("keydown keypress",function(e){"f7"===e.currentTarget.accessKey&&118===e.which&&(i.open({templateUrl:"/Assets/html/RoboticDescriptionMaintenanceModal.html",controller:"RoboticDescriptionMaintenanceCtrl",backdrop:"static",keyboard:!1,size:"lg",resolve:{headersToDisplay:function(){return n.headersToDisplay},fieldsToDisplay:function(){return n.fieldsToDisplay},pageTitle:function(){return n.pageTitle},type:function(){return n.type},listtype:function(){return n.listtype},showPanel:function(){return n.showpanel},addurl:function(){return n.addurl},editurl:function(){return n.editurl},keyid:function(){return n.keyid},roboticLines:function(){return t.roboticLines},lineIndex:function(){return t.editIndex}}}).result.then(function(e){t.roboticDescription_CallBack(e)}),e.preventDefault());"f2"===e.currentTarget.accessKey&&113===e.which&&(i.open({templateUrl:"/Assets/html/SearchGridTemplate.html",controller:"SearchGridTemplateCtrl",backdrop:"static",keyboard:!1,size:"lg",resolve:{headersToDisplay:function(){return n.headersToDisplay},fieldsToDisplay:function(){return n.fieldsToDisplay},pageTitle:function(){return n.pageTitle},type:function(){return n.type},listtype:function(){return n.listtype},showPanel:function(){return n.showpanel},addurl:function(){return n.addurl},editurl:function(){return n.editurl},keyid:function(){return n.keyid}}}).result.then(function(e){t.searchGridResult_CallBack(e)}),e.preventDefault())})}}}]),exeApp.controller("SearchGridTemplateCtrl",["$scope","$window","$uibModalInstance","$filter","SearchService","headersToDisplay","fieldsToDisplay","type","listtype","pageTitle","showPanel","addurl","editurl","keyid",function(n,t,i,o,e,r,a,s,l,c,u,d,p,f){n.listtitle="",n.curretSelection,n.resultList,n.selectedItemList,n.type=s,n.pageTitle=c,n.showPanel=null!=u&&u,n.labels=labels,n.keyid=f,n.searchKeyword="",n.$watch("searchKeyword",function(){switch(null!=l&&""!=l?l:n.type){case"IBA.Library.Controls.GLAccountSearchBox":h.getGLAccounts(n.searchKeyword,!1,!1,0,!0).then(function(e){n.resultList=e,n.keys=a.split(","),n.header=r.split(",");for(var t=0;t<n.header.length;t++)n.header[t]=n.header[t].replace(/([A-Z])/g," $1")});break;case"MFP.Library.Controls.SectorSearchBox":h.getSectors(n.searchKeyword,!0).then(function(e){n.resultList=e,n.keys=a.split(","),n.header=r.split(",");for(var t=0;t<n.header.length;t++)n.header[t]=n.header[t].replace(/([A-Z])/g," $1")})}}),n.performingAction=!1;var h=new e;n.Save=function(){"MFP.Library.Controls.SectorSearchBox"==n.type&&null!=n.selectedItemList?i.close(n.selectedItemList):i.close(n.curretSelection)},n.addnew=function(){t.open(d,"_blank")},n.showEdit=0<o("filter")(n.resultList,{$selected:!0}),n.edit=function(){var e=o("filter")(n.resultList,{$selected:!0});0<e.length&&t.open(p.replace("{0}",e[0].Id),"_blank")},n.Dismiss=function(){i.dismiss("cancel")},n.selectMe=function(e){i.close(e)},n.changeSelection=function(e){if("MFP.Library.Controls.SectorSearchBox"==n.type){e.$selected=!e.$selected;var t=o("filter")(n.resultList,{$selected:!0});1<t.length?n.selectedItemList=t:n.curretSelection=e}else n.curretSelection=e,angular.forEach(n.resultList,function(e,t){e.$selected=!1}),e.$selected=!0}}]),exeApp.controller("RoboticDescriptionMaintenanceCtrl",["$scope","$window","$uibModalInstance","$filter","SearchService","headersToDisplay","fieldsToDisplay","type","listtype","pageTitle","showPanel","addurl","editurl","keyid","roboticLines","lineIndex",function(o,e,t,n,i,r,a,s,l,c,u,d,p,f,h,g){o.listtitle="",o.curretSelection,o.type=s,o.pageTitle=c,o.showPanel=null!=u&&u,o.labels=labels,o.keyid=f,o.isArticle=-1<r.indexOf("Article"),o.searchKeyword="",o.editIndex=-1,o.roboticLines=h,o.returnData={},o.action=void 0;var m={Id:-1,fk_roboticmaintenance_id:f,Text:"",IsArticle:o.isArticle};o.$watch("roboticLines",function(){switch(null!=l&&""!=l?l:o.type){case"MFP.Library.Controls.RoboticMaintenanceDescriptionSearchBox":o.keys=a.split(","),o.header=r.split(",");for(var e=0;e<o.header.length;e++)o.header[e]=o.header[e].replace(/([A-Z])/g," $1");o.currentList=o.isArticle?o.roboticLines[g].ArticleCodeList:o.roboticLines[g].DescriptionList}});new i;o.Save=function(){t.close(o.roboticLines)},o.showEdit=0<n("filter")(o.roboticLines,{$selected:!0}),o.edit=function(e,t){o.action="edit";e.IsArticle?o.roboticLines[g].ArticleCodeList[t]:o.roboticLines[g].DescriptionList[t];o.editIndex=t},o.Dismiss=function(){t.dismiss("cancel")},o.changeSelection=function(e){o.curretSelection=e,angular.forEach(o.roboticLines[g],function(e,t){e.$selected=!1}),e.$selected=!0},o.saveRow=function(e,t){var n=(o.editIndex=null)==e?o.newItem:e;if(null!=n||0!=n.length){var i=angular.copy(n);i.IsArticle?"edit"===o.action?o.roboticLines[g].ArticleCodeList[t].Text=e.Text:o.roboticLines[g].ArticleCodeList.push(i):"edit"===o.action?o.roboticLines[g].DescriptionList[t].Text=e.Text:o.roboticLines[g].DescriptionList.push(i),o.currentList=i.IsArticle?o.roboticLines[g].ArticleCodeList:o.roboticLines[g].DescriptionList,o.newItem=null}o.action=void 0},o.addNewRow=function(){o.newItem=angular.copy(m),o.action="new"},o.removeRow=function(e){o.editIndex=null;var t=e.IsArticle?o.roboticLines[g].ArticleCodeList:o.roboticLines[g].DescriptionList,n=t.indexOf(e),i=t.splice(n,1);o.currentList=t,void 0!==e.Id&&-1!==e.Id&&(o.roboticLines[g].RemoveADList=$.map(i,function(e){return e}))}}]),exeApp.controller("SplitPopupCtrl",["$scope","$uibModalInstance","journal",function(e,t,n){e.j=n,e.labels=labels,e.pageNumber,e.cancel=function(){t.close("cancel")},e.split=function(){t.close(e.pageNumber)}}]),angular.module("ui.bootstrap.dropdownToggle",[]).directive("dropdownToggle",["$document","$location",function(i,e){var o=null,r=angular.noop;return{restrict:"CA",link:function(e,n,t){e.$watch("$location.path",function(){r()}),n.parent().bind("click",function(){r()}),n.bind("click",function(e){var t=n===o;e.preventDefault(),e.stopPropagation(),o&&r(),t||n.hasClass("disabled")||n.prop("disabled")||(n.parent().addClass("open"),o=n,r=function(e){e&&(e.preventDefault(),e.stopPropagation()),i.unbind("click",r),n.parent().removeClass("open"),r=angular.noop,o=null},i.bind("click",r))})}}}]);var taTools={};function registerTextAngularTool(e,t){if(!e||""===e||taTools.hasOwnProperty(e))throw"textAngular Error: A unique name is required for a Tool Definition";if(t.display&&(""===t.display||!validElementString(t.display))||!t.display&&!t.buttontext&&!t.iconclass)throw'textAngular Error: Tool Definition for "'+e+'" does not have a valid display/iconclass/buttontext value';taTools[e]=t}angular.module("textAngularSetup",[]).constant("taRegisterTool",registerTextAngularTool).value("taTools",taTools).value("taOptions",{forceTextAngularSanitize:!0,keyMappings:[],toolbar:[["h1","h2","h3","h4","h5","h6","p","pre","quote"],["bold","italics","underline","strikeThrough","ul","ol","redo","undo","clear"],["justifyLeft","justifyCenter","justifyRight","justifyFull","indent","outdent"],["html","insertImage","insertLink","insertVideo","wordcount","charcount"]],classes:{focussed:"focussed",toolbar:"btn-toolbar",toolbarGroup:"btn-group",toolbarButton:"btn btn-default",toolbarButtonActive:"active",disabled:"disabled",textEditor:"form-control",htmlEditor:"form-control"},defaultTagAttributes:{a:{target:""}},setup:{textEditorSetup:function(e){},htmlEditorSetup:function(e){}},defaultFileDropHandler:function(e,t){var n=new FileReader;return"image"===e.type.substring(0,5)&&(n.onload=function(){""!==n.result&&t("insertImage",n.result,!0)},n.readAsDataURL(e),!0)}}).value("taSelectableElements",["a","img"]).value("taCustomRenderers",[{selector:"img",customAttribute:"ta-insert-video",renderLogic:function(e){var t=angular.element("<iframe></iframe>"),n=e.prop("attributes");angular.forEach(n,function(e){t.attr(e.name,e.value)}),t.attr("src",t.attr("ta-insert-video")),e.replaceWith(t)}}]).value("taTranslations",{html:{tooltip:"Toggle html / Rich Text"},heading:{tooltip:"Heading "},p:{tooltip:"Paragraph"},pre:{tooltip:"Preformatted text"},ul:{tooltip:"Unordered List"},ol:{tooltip:"Ordered List"},quote:{tooltip:"Quote/unquote selection or paragraph"},undo:{tooltip:"Undo"},redo:{tooltip:"Redo"},bold:{tooltip:"Bold"},italic:{tooltip:"Italic"},underline:{tooltip:"Underline"},strikeThrough:{tooltip:"Strikethrough"},justifyLeft:{tooltip:"Align text left"},justifyRight:{tooltip:"Align text right"},justifyFull:{tooltip:"Justify text"},justifyCenter:{tooltip:"Center"},indent:{tooltip:"Increase indent"},outdent:{tooltip:"Decrease indent"},clear:{tooltip:"Clear formatting"},insertImage:{dialogPrompt:"Please enter an image URL to insert",tooltip:"Insert image",hotkey:"the - possibly language dependent hotkey ... for some future implementation"},insertVideo:{tooltip:"Insert video",dialogPrompt:"Please enter a youtube URL to embed"},insertLink:{tooltip:"Insert / edit link",dialogPrompt:"Please enter a URL to insert"},editLink:{reLinkButton:{tooltip:"Relink"},unLinkButton:{tooltip:"Unlink"},targetToggle:{buttontext:"Open in New Window"}},wordcount:{tooltip:"Display words Count"},charcount:{tooltip:"Display characters Count"}}).factory("taToolFunctions",["$window","taTranslations",function(c,u){return{imgOnSelectAction:function(e,t,n){var i=function(){n.updateTaBindtaTextElement(),n.hidePopover()};e.preventDefault(),n.displayElements.popover.css("width","375px");var o=n.displayElements.popoverContainer;o.empty();var r=angular.element('<div class="btn-group" style="padding-right: 6px;">'),a=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">100% </button>');a.on("click",function(e){e.preventDefault(),t.css({width:"100%",height:""}),i()});var s=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">50% </button>');s.on("click",function(e){e.preventDefault(),t.css({width:"50%",height:""}),i()});var l=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">25% </button>');l.on("click",function(e){e.preventDefault(),t.css({width:"25%",height:""}),i()});var c=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">Reset</button>');c.on("click",function(e){e.preventDefault(),t.css({width:"",height:""}),i()}),r.append(a),r.append(s),r.append(l),r.append(c),o.append(r),r=angular.element('<div class="btn-group" style="padding-right: 6px;">');var u=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-left"></i></button>');u.on("click",function(e){e.preventDefault(),t.css("float","left"),t.css("cssFloat","left"),t.css("styleFloat","left"),i()});var d=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-right"></i></button>');d.on("click",function(e){e.preventDefault(),t.css("float","right"),t.css("cssFloat","right"),t.css("styleFloat","right"),i()});var p=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-justify"></i></button>');p.on("click",function(e){e.preventDefault(),t.css("float",""),t.css("cssFloat",""),t.css("styleFloat",""),i()}),r.append(u),r.append(p),r.append(d),o.append(r),r=angular.element('<div class="btn-group">');var f=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-trash-o"></i></button>');f.on("click",function(e){e.preventDefault(),t.remove(),i()}),r.append(f),o.append(r),n.showPopover(t),n.showResizeOverlay(t)},aOnSelectAction:function(e,n,i){e.preventDefault(),i.displayElements.popover.css("width","436px");var t=i.displayElements.popoverContainer;t.empty(),t.css("line-height","28px");var o=angular.element('<a href="'+n.attr("href")+'" target="_blank">'+n.attr("href")+"</a>");o.css({display:"inline-block","max-width":"200px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","vertical-align":"middle"}),t.append(o);var r=angular.element('<div class="btn-group pull-right">'),a=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on" title="'+u.editLink.reLinkButton.tooltip+'"><i class="fa fa-edit icon-edit"></i></button>');a.on("click",function(e){e.preventDefault();var t=c.prompt(u.insertLink.dialogPrompt,n.attr("href"));t&&""!==t&&"http://"!==t&&(n.attr("href",t),i.updateTaBindtaTextElement()),i.hidePopover()}),r.append(a);var s=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on" title="'+u.editLink.unLinkButton.tooltip+'"><i class="fa fa-unlink icon-unlink"></i></button>');s.on("click",function(e){e.preventDefault(),n.replaceWith(n.contents()),i.updateTaBindtaTextElement(),i.hidePopover()}),r.append(s);var l=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on">'+u.editLink.targetToggle.buttontext+"</button>");"_blank"===n.attr("target")&&l.addClass("active"),l.on("click",function(e){e.preventDefault(),n.attr("target","_blank"===n.attr("target")?"":"_blank"),l.toggleClass("active"),i.updateTaBindtaTextElement()}),r.append(l),t.append(r),i.showPopover(n)},extractYoutubeVideoId:function(e){var t=e.match(/(?:youtube(?:-nocookie)?\.com\/(?:[^\/\n\s]+\/\S+\/|(?:v|e(?:mbed)?)\/|\S*?[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/i);return t&&t[1]||null}}}]).run(["taRegisterTool","$window","taTranslations","taSelection","taToolFunctions","$sanitize","taOptions",function(n,i,o,g,r,e,t){var a={};if(e("",a),!0===t.forceTextAngularSanitize&&"taSanitize"!==a.version)throw angular.$$minErr("textAngular")("textAngularSetup","The textAngular-sanitize provider has been replaced by another -- have you included angular-sanitize by mistake?");n("html",{iconclass:"fa fa-code",tooltiptext:o.html.tooltip,action:function(){this.$editor().switchView()},activeState:function(){return this.$editor().showHtml}});var s=function(){return this.$editor().wrapSelection("formatBlock","<"+this.name.toUpperCase()+">")};angular.forEach(["h1","h2","h3","h4","h5","h6"],function(e){var t;n(e.toLowerCase(),{buttontext:e.toUpperCase(),tooltiptext:o.heading.tooltip+e.charAt(1),action:s,activeState:(t=e.toLowerCase(),function(){return this.$editor().queryFormatBlockState(t)})})}),n("p",{buttontext:"P",tooltiptext:o.p.tooltip,action:function(){return this.$editor().wrapSelection("formatBlock","<P>")},activeState:function(){return this.$editor().queryFormatBlockState("p")}}),n("pre",{buttontext:"pre",tooltiptext:o.pre.tooltip,action:function(){return this.$editor().wrapSelection("formatBlock","<PRE>")},activeState:function(){return this.$editor().queryFormatBlockState("pre")}}),n("ul",{iconclass:"fa fa-list-ul",tooltiptext:o.ul.tooltip,action:function(){return this.$editor().wrapSelection("insertUnorderedList",null)},activeState:function(){return this.$editor().queryCommandState("insertUnorderedList")}}),n("ol",{iconclass:"fa fa-list-ol",tooltiptext:o.ol.tooltip,action:function(){return this.$editor().wrapSelection("insertOrderedList",null)},activeState:function(){return this.$editor().queryCommandState("insertOrderedList")}}),n("quote",{iconclass:"fa fa-quote-right",tooltiptext:o.quote.tooltip,action:function(){return this.$editor().wrapSelection("formatBlock","<BLOCKQUOTE>")},activeState:function(){return this.$editor().queryFormatBlockState("blockquote")}}),n("undo",{iconclass:"fa fa-undo",tooltiptext:o.undo.tooltip,action:function(){return this.$editor().wrapSelection("undo",null)}}),n("redo",{iconclass:"fa fa-repeat",tooltiptext:o.redo.tooltip,action:function(){return this.$editor().wrapSelection("redo",null)}}),n("bold",{iconclass:"fa fa-bold",tooltiptext:o.bold.tooltip,action:function(){return this.$editor().wrapSelection("bold",null)},activeState:function(){return this.$editor().queryCommandState("bold")},commandKeyCode:98}),n("justifyLeft",{iconclass:"fa fa-align-left",tooltiptext:o.justifyLeft.tooltip,action:function(){return this.$editor().wrapSelection("justifyLeft",null)},activeState:function(e){if(e&&"#document"===e.nodeName)return!1;var t=!1;return e&&(t="left"===e.css("text-align")||"left"===e.attr("align")||"right"!==e.css("text-align")&&"center"!==e.css("text-align")&&"justify"!==e.css("text-align")&&!this.$editor().queryCommandState("justifyRight")&&!this.$editor().queryCommandState("justifyCenter")&&!this.$editor().queryCommandState("justifyFull")),t=t||this.$editor().queryCommandState("justifyLeft")}}),n("justifyRight",{iconclass:"fa fa-align-right",tooltiptext:o.justifyRight.tooltip,action:function(){return this.$editor().wrapSelection("justifyRight",null)},activeState:function(e){if(e&&"#document"===e.nodeName)return!1;var t=!1;return e&&(t="right"===e.css("text-align")),t=t||this.$editor().queryCommandState("justifyRight")}}),n("justifyFull",{iconclass:"fa fa-align-justify",tooltiptext:o.justifyFull.tooltip,action:function(){return this.$editor().wrapSelection("justifyFull",null)},activeState:function(e){var t=!1;return e&&(t="justify"===e.css("text-align")),t=t||this.$editor().queryCommandState("justifyFull")}}),n("justifyCenter",{iconclass:"fa fa-align-center",tooltiptext:o.justifyCenter.tooltip,action:function(){return this.$editor().wrapSelection("justifyCenter",null)},activeState:function(e){if(e&&"#document"===e.nodeName)return!1;var t=!1;return e&&(t="center"===e.css("text-align")),t=t||this.$editor().queryCommandState("justifyCenter")}}),n("indent",{iconclass:"fa fa-indent",tooltiptext:o.indent.tooltip,action:function(){return this.$editor().wrapSelection("indent",null)},activeState:function(){return this.$editor().queryFormatBlockState("blockquote")},commandKeyCode:"TabKey"}),n("outdent",{iconclass:"fa fa-outdent",tooltiptext:o.outdent.tooltip,action:function(){return this.$editor().wrapSelection("outdent",null)},activeState:function(){return!1},commandKeyCode:"ShiftTabKey"}),n("italics",{iconclass:"fa fa-italic",tooltiptext:o.italic.tooltip,action:function(){return this.$editor().wrapSelection("italic",null)},activeState:function(){return this.$editor().queryCommandState("italic")},commandKeyCode:105}),n("underline",{iconclass:"fa fa-underline",tooltiptext:o.underline.tooltip,action:function(){return this.$editor().wrapSelection("underline",null)},activeState:function(){return this.$editor().queryCommandState("underline")},commandKeyCode:117}),n("strikeThrough",{iconclass:"fa fa-strikethrough",tooltiptext:o.strikeThrough.tooltip,action:function(){return this.$editor().wrapSelection("strikeThrough",null)},activeState:function(){return document.queryCommandState("strikeThrough")}}),n("clear",{iconclass:"fa fa-ban",tooltiptext:o.clear.tooltip,action:function(e,t){var n;this.$editor().wrapSelection("removeFormat",null);var i=angular.element(g.getSelectionElement()),o=function(e){var n=e=angular.element(e);angular.forEach(e.children(),function(e){var t=angular.element("<p></p>");t.html(angular.element(e).html()),n.after(t),n=t}),e.remove()};if(angular.forEach(i.find("ul"),o),angular.forEach(i.find("ol"),o),"li"===i[0].tagName.toLowerCase()){var r=i[0].parentNode.childNodes,a=[],s=[],l=!1;for(n=0;n<r.length;n++)r[n]===i[0]?l=!0:l?s.push(r[n]):a.push(r[n]);var c=angular.element(i[0].parentNode),u=angular.element("<p></p>");if(u.html(angular.element(i[0]).html()),0===a.length||0===s.length)0===s.length?c.after(u):c[0].parentNode.insertBefore(u[0],c[0]),0===a.length&&0===s.length?c.remove():angular.element(i[0]).remove();else{var d=angular.element("<"+c[0].tagName+"></"+c[0].tagName+">"),p=angular.element("<"+c[0].tagName+"></"+c[0].tagName+">");for(n=0;n<a.length;n++)d.append(angular.element(a[n]));for(n=0;n<s.length;n++)p.append(angular.element(s[n]));c.after(p),c.after(u),c.after(d),c.remove()}g.setSelectionToElementEnd(u[0])}var f=this.$editor(),h=function(e){(e=angular.element(e))[0]!==f.displayElements.text[0]&&e.removeAttr("class"),angular.forEach(e.children(),h)};angular.forEach(i,h),"li"!==i[0].tagName.toLowerCase()&&"ol"!==i[0].tagName.toLowerCase()&&"ul"!==i[0].tagName.toLowerCase()&&this.$editor().wrapSelection("formatBlock","default"),t()}}),n("insertImage",{iconclass:"fa fa-picture-o",tooltiptext:o.insertImage.tooltip,action:function(){var e;if((e=i.prompt(o.insertImage.dialogPrompt,"http://"))&&""!==e&&"http://"!==e)return this.$editor().wrapSelection("insertImage",e,!0)},onElementSelect:{element:"img",action:r.imgOnSelectAction}}),n("insertVideo",{iconclass:"fa fa-youtube-play",tooltiptext:o.insertVideo.tooltip,action:function(){var e;if((e=i.prompt(o.insertVideo.dialogPrompt,"https://"))&&""!==e&&"https://"!==e&&(videoId=r.extractYoutubeVideoId(e),videoId)){var t="https://www.youtube.com/embed/"+videoId,n='<img class="ta-insert-video" src="https://img.youtube.com/vi/'+videoId+'/hqdefault.jpg" ta-insert-video="'+t+'" contenteditable="false" allowfullscreen="true" frameborder="0" />';return this.$editor().wrapSelection("insertHTML",n,!0)}},onElementSelect:{element:"img",onlyWithAttrs:["ta-insert-video"],action:r.imgOnSelectAction}}),n("insertLink",{tooltiptext:o.insertLink.tooltip,iconclass:"fa fa-link",action:function(){var e;if((e=i.prompt(o.insertLink.dialogPrompt,"http://"))&&""!==e&&"http://"!==e)return this.$editor().wrapSelection("createLink",e,!0)},activeState:function(e){return!!e&&"A"===e[0].tagName},onElementSelect:{element:"a",action:r.aOnSelectAction}}),n("wordcount",{display:'<div id="toolbarWC" style="display:block; min-width:100px;">Words: <span ng-bind="wordcount"></span></div>',disabled:!0,wordcount:0,activeState:function(){var e=this.$editor().displayElements.text[0].innerHTML||"",t=0;return""!==e.replace(/\s*<[^>]*?>\s*/g,"")&&(t=e.replace(/<\/?(b|i|em|strong|span|u|strikethrough|a|img|small|sub|sup|label)( [^>*?])?>/gi,"").replace(/(<[^>]*?>\s*<[^>]*?>)/gi," ").replace(/(<[^>]*?>)/gi,"").replace(/\s+/gi," ").match(/\S+/g).length),this.wordcount=t,this.$editor().wordcount=t,!1}}),n("charcount",{display:'<div id="toolbarCC" style="display:block; min-width:120px;">Characters: <span ng-bind="charcount"></span></div>',disabled:!0,charcount:0,activeState:function(){var e=this.$editor().displayElements.text,t=(e[0].innerText||e[0].textContent).replace(/(\r\n|\n|\r)/gm,"").replace(/^\s+/g," ").replace(/\s+$/g," ").length;return this.charcount=t,this.$editor().charcount=t,!1}})}]),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.TimePicker=t()}(this,function(){"use strict";var a="_jw-tpk",e="-container",t="-header",n="-body",i="-hour",o="-minute",r="-selected",s="-dragging",l={hour:"data-hour",minute:"data-minute"},c={hour_list:"hour_list_id",minute_list:"minute_list_id"},u={namespace:a,width:"250px",height:"140px",container_class:e,header_class:t,body_class:n,hour_class:i,minute_class:o,selected_class:r,dragging_class:s,attr:l,ids:c},d=Object.freeze({namespace:a,width:"250px",height:"140px",container_class:e,header_class:t,body_class:n,hour_class:i,minute_class:o,selected_class:r,dragging_class:s,attr:l,ids:c,default:u}),p="open",f="close",h="change",g="start-fade-in",m="end-fade-in",v="start-fade-out",y="end-fade-out",b={lang:"en",theme:"dark"},x={en:{hour:"Hour",minute:"Minute"},pt:{hour:"Hora",minute:"Minuto"}},S=d,C={container:a+e,header:a+t,body:a+n,hour:a+i,minute:a+o,selected:a+r,dragging:a+s},w={focusable:/^(?:input|select|textarea|button|object)$/i,clickable:/^(?:a|area)$/i,classRegex:function(e){return new RegExp("(^|\\s+) "+e+" (\\s+|$)")},addClass:function(e,t,n){var i=this;if(Array.isArray(e))e.forEach(function(e){i.addClass(e,t)});else for(var o=Array.isArray(t)?t:t.split(/\s+/),r=o.length;r--;)i.hasClass(e,o[r])||i._addClass(e,o[r],n)},_addClass:function(e,t,n){var i=this;e.classList?e.classList.add(t):e.className=(e.className+" "+t).trim(),n&&this.isNumeric(n)&&window.setTimeout(function(){i._removeClass(e,t)},n)},removeClass:function(e,t,n){var i=this;if(Array.isArray(e))e.forEach(function(e){i.removeClass(e,t,n)});else for(var o=Array.isArray(t)?t:t.split(/\s+/),r=o.length;r--;)i.hasClass(e,o[r])&&i._removeClass(e,o[r],n)},_removeClass:function(e,t,n){var i=this;e.classList?e.classList.remove(t):e.className=e.className.replace(this.classRegex(t)," ").trim(),n&&this.isNumeric(n)&&window.setTimeout(function(){i._addClass(e,t)},n)},hasClass:function(e,t){return e.classList?e.classList.contains(t):this.classRegex(t).test(e.className)},toggleClass:function(e,t){var n=this;return Array.isArray(e)?void e.forEach(function(e){n.toggleClass(e,t)}):void(e.classList?e.classList.toggle(t):this.hasClass(e,t)?this._removeClass(e,t):this._addClass(e,t))},$:function(e){return e="#"===e[0]?e.substr(1,e.length):e,document.getElementById(e)},isElement:function(e){return"HTMLElement"in window?!!e&&e instanceof HTMLElement:!!e&&"object"==typeof e&&1===e.nodeType&&!!e.nodeName},getAllChildren:function(e,t){return[].slice.call(e.getElementsByTagName(t))},getMaxZIndex:function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=-1);for(var i=this.find("*",document,!0),o=i.length;++n<o;)t=(e=parseInt(window.getComputedStyle(i[n]).zIndex,10))?Math.max(t,e):t;return t},mergeOptions:function(e,t){var n={};for(var i in e)n[i]=e[i];for(var o in t)n[o]=t[o];return n},createElement:function(e,t){var n;if(Array.isArray(e)){if(n=document.createElement(e[0]),e[1].id&&(n.id=e[1].id),e[1].classname&&(n.className=e[1].classname),e[1].attr){var i=e[1].attr;if(Array.isArray(i))for(var o=-1;++o<i.length;)n.setAttribute(i[o].name,i[o].value);else n.setAttribute(i.name,i.value)}}else n=document.createElement(e);n.innerHTML=t;for(var r=document.createDocumentFragment();n.childNodes[0];)r.appendChild(n.childNodes[0]);return n.appendChild(r),n},find:function(e,t,n){var i=[].slice,o=[];if(/^(#?[\w-]+|\.[\w-.]+)$/.test(e))switch(e[0]){case"#":o=[this.$(e.substr(1))];break;case".":o=i.call(t.getElementsByClassName(e.substr(1).replace(/\./g," ")));break;default:o=i.call(t.getElementsByTagName(e))}else o=i.call(t.querySelectorAll(e));return n?o:o[0]},offset:function(e){var t=e.getBoundingClientRect(),n=document.documentElement;return{left:t.left+window.pageXOffset-n.clientLeft,top:t.top+window.pageYOffset-n.clientTop,width:e.offsetWidth,height:e.offsetHeight}},getWindowSize:function(){return{width:window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,height:window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}},evaluate:function(e){var t;switch(this.toType(e)){case"window":case"htmldocument":case"element":t=e;break;case"string":t=this.$(e);break;default:console.warn("Unknown type")}return this.assert(t,"Can't evaluate: @param "+e),t},toType:function(e){return e===window&&e.document&&e.location?"window":e===document?"htmldocument":"string"==typeof e?"string":this.isElement(e)?"element":void 0},typeOf:function(e){return{}.toString.call(e).match(/\s([a-zA-Z]+)/)[1].toLowerCase()},events:function(){var i={},o=i.hasOwnProperty;return{subscribe:function(e,t){o.call(i,e)||(i[e]=[]);var n=i[e].push(t)-1;return{remove:function(){delete i[e][n]}}},publish:function(e,t){o.call(i,e)&&i[e].forEach(function(e){e(void 0!==t?t:{})})}}},fade:function(t,n,i,o){void 0===i&&(i=300),void 0===o&&(o="in");var r,a=null,s=!1,l="in"===o?g:v,c="in"===o?m:y,u=function(e){a||(t.publish(l,{target:n}),a=e),"in"===o?(r=+n.style.opacity+(e-a)/i,s=1<=r):(r=+n.style.opacity-(e-a)/i,s=r<=0),n.style.opacity=r,s?t.publish(c,{target:n}):window.requestAnimationFrame(u)};return window.requestAnimationFrame(u)},assert:function(e,t){if(!e){if(t=t||"Assertion failed","undefined"!=typeof Error)throw new Error(t);throw t}}},A=function(e){this.Base=e};A.prototype.createPicker=function(){for(var e,t,n=this.Base.options,i=A.picker.indexOf(A.replace.hour_list),o=A.picker.indexOf(A.replace.minute_list),r=A.picker.indexOf(A.replace.hour_title),a=A.picker.indexOf(A.replace.minute_title),s=[],l=[],c=0,u=6,d=0;d<4;d++){for(t=c+u,s.push("<ol>");c<t;c++)s.push(["<li><a ",S.attr.hour,'="',c,'">',c,"</a></li>"].join(""));s.push("</ol>")}for(u=15,d=t=c=0;d<4;d++){for(t=c+u,l.push("<ol>");c<t;c+=5)e=c<10?e="0"+c:c,l.push(["<li><a ",S.attr.minute,'="',e,'">',e,"</a></li>"].join(""));l.push("</ol>")}A.picker[i]=s.join(""),A.picker[o]=l.join(""),A.picker[r]=x[n.lang].hour,A.picker[a]=x[n.lang].minute;var p=w.createElement(["div",{classname:C.container+" "+S.namespace+"-"+n.theme}],A.picker.join(""));p.style.zIndex=w.getMaxZIndex()+10,p.style.visibility="hidden",document.body.appendChild(p);var f=w.offset(p);return this.Base.container={size:{width:f.width,height:f.height},element:p,drag_handle:p.querySelector("."+C.header)},p.style.visibility="",p.style.display="none",p},A.picker=['<div class="'+C.header+'">','<div class="'+C.hour+'">',(A.replace={hour_list:"__hour-list__",minute_list:"__minute-list__",hour_title:"__hour-title__",minute_title:"__minute-title__"}).hour_title,"</div>",'<div class="'+C.minute+'">',A.replace.minute_title,"</div>","</div>",'<div class="'+C.body+'">','<div id="'+S.ids.hour_list+'" class="'+C.hour+'">',A.replace.hour_list,"</div>",'<div id="'+S.ids.minute_list+'" class="'+C.minute+'">',A.replace.minute_list,"</div>","</div>"];var $=function(e){var t,n,i,o,r,a,s=e.container.element,l={},c=function(e){e.preventDefault&&e.preventDefault(),i=parseInt(s.style.left,10)||0,o=parseInt(s.style.top,10)||0,r=i+(e.clientX-t),a=o+(e.clientY-n),l.move.call(void 0,{target:s,x:r,y:a}),t=e.clientX,n=e.clientY},u=function(){document.removeEventListener("mousemove",c,!1),document.removeEventListener("mouseup",stop,!1),l.end.call(void 0,{target:s,x:r,y:a})};return e.container.drag_handle.addEventListener("mousedown",function(e){0===e.button&&(t=e.clientX,n=e.clientY,l.start.call({target:s}),document.addEventListener("mousemove",c,!1),document.addEventListener("mouseup",u,!1))},!1),{when:function(e){l.start=e.start,l.move=e.move,l.end=e.end}}},L=function(e){this.Base=e,this.container=e.container.element,this.closeWhen={hour:!1,minute:!1},this._ids=0,this.id_active=void 0,this.opened=!1,this.targets=[],this.collection={hours:[],minutes:[]},this.events=w.events(),this.request_ani_id=void 0};L.prototype.init=function(){this.setFocusListener(this.Base.target),this.setSelectListener()},L.prototype.show=function(e){var t=this.targets[e].element,n=w.offset(t),i=this.Base.container.size,o=n.top+n.height+5,r=w.getWindowSize();n.left+i.width>r.width?(this.container.style.left="",this.container.style.right="5px"):(this.container.style.right="",this.container.style.left=n.left+"px"),n.top+i.height>r.height?this.container.style.bottom="5px":this.container.style.top=o+"px",this.events.subscribe(g,function(e){e.target.style.opacity=0,e.target.style.display="block"}),this.request_ani_id=w.fade(this.events,this.container,400),this.Base.dispatchEvent(p,{element:t}),this.handleOpen(e)},L.prototype.show_=function(){var t=this;this.targets.forEach(function(e){t.show(e.element._id)})},L.prototype.hide=function(e){this.opened=!1,this.events.subscribe(v,function(e){e.target.style.opacity=1,e.target.style.display="block"}),this.events.subscribe(y,function(e){e.target.style.display="none"}),this.request_ani_id=w.fade(this.events,this.container,800,"out"),this.Base.dispatchEvent(f,{element:this.targets[e].element})},L.prototype.hide_=function(){var t=this;this.targets.forEach(function(e){t.hide(e.element._id)})},L.prototype.handleOpen=function(e){var t=this,i=this,n=this.targets[e].hour,o=this.targets[e].minute;w.removeClass(this.collection.hours,C.selected),w.removeClass(this.collection.minutes,C.selected),n&&o&&(this.collection.hours.forEach(function(e){t.getHour(e)!==n||w.addClass(e,C.selected)}),this.collection.minutes.forEach(function(e){t.getMinute(e)!==o||w.addClass(e,C.selected)})),document.addEventListener("mousedown",{handleEvent:function(t){if(!i.container.contains(t.target)){var n=!1;i.targets.forEach(function(e){e.element===t.target&&(n=!0)}),!n&&i.opened&&i.hide(e),i.targets[e].element!==t.target&&document.removeEventListener(t.type,this,!1)}}},!1),this.opened=!0,this.id_active=e,this.closeWhen={hour:!1,minute:!1}},L.prototype.handleClose=function(e){this.closeWhen.hour&&this.closeWhen.minute&&this.hide(e)},L.prototype.getHour=function(e){return e.getAttribute(S.attr.hour)},L.prototype.getMinute=function(e){return e.getAttribute(S.attr.minute)},L.prototype.setSelectListener=function(){var n=this,e=w.$(S.ids.hour_list),t=w.$(S.ids.minute_list),i=function(e){e.preventDefault();var t=n.targets[n.id_active];t.hour=n.getHour(e.target),n.Base.dispatchEvent(h,{element:t.element,hour:t.hour,minute:t.minute}),w.removeClass(n.collection.hours,C.selected),w.addClass(e.target,C.selected),n.closeWhen.hour=!0,n.handleClose(n.id_active)},o=function(e){e.preventDefault();var t=n.targets[n.id_active];t.minute=n.getMinute(e.target),n.Base.dispatchEvent(h,{element:t.element,hour:t.hour,minute:t.minute}),w.removeClass(n.collection.minutes,C.selected),w.addClass(e.target,C.selected),n.closeWhen.minute=!0,n.handleClose(n.id_active)};this.collection.hours=w.getAllChildren(e,"a"),this.collection.minutes=w.getAllChildren(t,"a"),this.collection.hours.forEach(function(e){e.addEventListener("click",i)}),this.collection.minutes.forEach(function(e){e.addEventListener("click",o)})},L.prototype.setFocusListener=function(e){var n,i=this,o=function(e){e.preventDefault(),window.cancelAnimationFrame(i.request_ani_id),i.show(e.target._id)},t=[];e=Array.isArray(e)?e:[e],Array.prototype.push.apply(t,e),t.forEach(function(e){if(n=w.evaluate(e)){var t=i._ids++;n._id=t,i.targets[t]={element:n},w.focusable.test(n.nodeName)?n.addEventListener("focus",o,!0):w.clickable.test(n.nodeName)&&n.addEventListener("click",o,!0)}})};var E=function(){this._events=this._events||{},this._onceEvents=this._onceEvents||{}};return E.prototype.on=function(e,t){if(e&&t){var n=this._events[e]=this._events[e]||[];return-1===n.indexOf(t)&&n.push(t),this}},E.prototype.once=function(e,t){if(e&&t)return this.on(e,t),(this._onceEvents[e]=this._onceEvents[e]||{})[t]=!0,this},E.prototype.off=function(e,t){var n=this._events&&this._events[e];if(n&&n.length){var i=n.indexOf(t);return-1!==i&&n.splice(i,1),this}},E.prototype.dispatchEvent=function(e,t){void 0===t&&(t={});var n=this._events&&this._events[e];if(n&&n.length){for(var i=0,o=n[i],r=this._onceEvents&&this._onceEvents[e];o;){var a=r&&r[o];a&&(this.off(e,o),delete r[o]),o.call(this,t),o=n[i+=a?0:1]}return this}},function(o){function r(e,t){void 0===t&&(t={}),w.assert(Array.isArray(e)||"string"===w.typeOf(e)||w.isElement(e),"`target` should be Element, <Array>Element, String or <Array>String."),o.call(this),this.options=w.mergeOptions(b,t),this.target=e,this.container={};var n=new A(this).createPicker(),i=new $(this);(r.Internal=new L(this)).init(),i.when({start:function(){w.addClass(n,a+s)},move:function(e){n.style.left=e.x+"px",n.style.top=e.y+"px"},end:function(e){w.removeClass(n,a+s),e.y<0&&(n.style.top=0)}})}return o&&(r.__proto__=o),((r.prototype=Object.create(o&&o.prototype)).constructor=r).prototype.show=function(){r.Internal.show_()},r.prototype.hide=function(){r.Internal.hide_()},r.prototype.setTarget=function(e){w.assert(Array.isArray(e)||"string"===w.typeOf(e)||w.isElement(e),"`target` should be Element, <Array>Element, String or <Array>String."),this.target=e,r.Internal.setFocusListener(this.target)},r}(E)});